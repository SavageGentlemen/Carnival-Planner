{"file_contents":{"replit.md":{"content":"# Caribbean Carnival Planner\n\n## Overview\n\nCaribbean Carnival Planner is a Progressive Web App (PWA) designed to help users discover, plan, and track Caribbean carnival events. The application provides carnival countdown features, event information, and premium subscription capabilities through Stripe integration.\n\nThe app is built as a React single-page application with Firebase as the backend-as-a-service platform, providing authentication, Firestore database, and hosting.\n\n## Freemium Model\n\n**All core planning features are FREE:**\n- Google and Email/Password authentication\n- Carnival selection (15+ carnivals)\n- Multi-carnival planning\n- Budget planner\n- Costume tracker\n- Event scheduler with curated popular events\n- Packing list\n- Squad coordination with share codes\n- Road Ready Mode\n- Export itinerary\n\n**Premium subscription provides:**\n- Ad-free experience (removes promotional ads and the \"Unlock Premium Features\" banner)\n- Premium Supporter badge displayed in the header\n- Interactive Fete Map (Map tab) - country-specific maps with pins for accommodation, fetes, costume pickup, meetup spots with distance calculations\n- Media Vault (Media tab) - upload and store tickets, photos, and important documents for each carnival with view/download/delete capabilities\n- Offline Mode - Firestore data cached locally for use without internet connection\n- Road Ready Squad Alerts - Push notifications to squad members when you go Road Ready (toggle in Squad tab)\n\n**Admin Features (djkrss1@gmail.com only):**\n- Ad Manager - Upload and manage promotional ads/flyers shown to free users\n  - Located in Info tab\n  - Upload images up to 5MB\n  - Set optional title and click-through URL\n  - Toggle ads active/inactive\n  - Auto-rotation for multiple ads\n\nThe premium model provides enhanced features for travelers while keeping core planning functionality free.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Design Notes\n\n### Splash Page (Dec 2025 - Redesigned)\nNew multi-section scrollable splash page (`src/components/SplashPage.jsx`):\n- **Hero Section**: Animated parallax background orbs, logo with glow effect, \"Plan Your Perfect Carnival\" gradient title, \"Get Started Free\" CTA button\n- **Carnival Carousel**: Auto-rotating showcase of 6 featured carnivals (Trinidad, Jamaica, St. Lucia, Antigua, Miami, Notting Hill) with colorful gradient cards\n- **Free Features Section**: 6 feature cards with icons (Budget Planner, Costume Tracker, Event Scheduler, Squad Coordination, Packing List, Road Ready Mode) - marked as \"100% FREE\"\n- **Premium Features Section**: 4 premium feature cards (Interactive Fete Map, Media Vault, Offline Mode, Ad-Free Experience) with pricing ($4.99/month or $39.99/year)\n- **Final CTA Section**: \"Ready to Plan Your Best Carnival Yet?\" with large action button\n- **Footer**: Logo, tagline, legal links (Privacy Policy, Terms of Service, Cookie Policy, Refund Policy), and copyright\n\n### Legal Pages (Dec 2025)\nComprehensive legal documentation in `src/components/LegalPages.jsx`:\n- **Privacy Policy**: GDPR/CCPA compliant, covers Google Auth data, Firebase storage, Stripe payments, user rights\n- **Terms of Service**: User accounts, premium subscriptions, user content, acceptable use, liability\n- **Cookie Policy**: Essential cookies (Firebase Auth), functional cookies, third-party cookies, management instructions\n- **Refund Policy**: Subscription cancellation terms, refund eligibility, process for requesting refunds\n\nLegal pages are accessible from footer links on both the splash page and main app view.\n\n## System Architecture\n\n### Frontend Architecture\n\n- **Framework**: React 18 with Vite as the build tool and dev server\n- **Styling**: Tailwind CSS with PostCSS and Autoprefixer for utility-first styling\n- **Dark Mode**: Manual dark mode toggling enabled via Tailwind's `class` strategy\n- **PWA Support**: Full Progressive Web App setup with manifest.json, service worker support, and mobile-optimized meta tags\n- **Icons**: Lucide React for iconography\n- **Utilities**: clsx and tailwind-merge for conditional class handling\n\n### Backend Architecture\n\n- **Platform**: Firebase (Authentication, Firestore, Hosting, Cloud Functions)\n- **Cloud Functions**: Node.js 20 runtime in `functions2/` directory\n- **Payment Processing**: Stripe integration for premium subscriptions\n  - Checkout session creation\n  - Webhook handling for subscription events\n  - Premium status management in Firestore\n\n### Data Storage\n\n- **Database**: Firebase Firestore\n- **Data Model**: User premium status stored under app-specific paths using `APP_ID = \"carnival-planner-v1\"`\n- **Static Data**: Carnival events stored in `src/carnivals.js` as a JavaScript array with name and date fields\n\n### Authentication\n\n- **Provider**: Firebase Authentication\n- **Methods**: \n  - Google Sign-In (OAuth popup)\n  - Email/Password authentication with email verification\n- **Email Auth Features** (`src/components/EmailAuthForm.jsx`):\n  - Sign-up with email verification\n  - Login with password\n  - Password reset via email\n  - Email verification banner for unverified users\n- **Integration**: Firebase Auth SDK initialized in `src/firebase.js`\n\n### Additional Features (Dec 2025)\n\n- **PWA Install Prompt** (`src/components/InstallPrompt.jsx`):\n  - Detects `beforeinstallprompt` event\n  - Shows non-intrusive install banner\n  - \"Add to Home Screen\" button for mobile users\n  \n- **Contact/Support** (`src/components/ContactSupport.jsx`):\n  - Contact form that saves to Firestore `support-requests` collection\n  - Admin view in Info tab (djkrss1@gmail.com only)\n  - Support request management interface\n  \n- **Account Settings** (`src/components/AccountSettings.jsx`):\n  - Account deletion with confirmation (type \"DELETE\")\n  - Deletes all user data from Firestore, Storage, and Auth\n  - Removes user from shared squad plans\n  \n- **Cloud Functions** (`functions2/index.js`):\n  - `deleteUserAccount`: Complete account deletion with data cleanup\n\n### Build and Deployment\n\n- **Development**: `vite` dev server on port 5000, accessible from all hosts\n- **Production Build**: Outputs to `dist/` directory\n- **Hosting**: Firebase Hosting with SPA rewrite rules (all routes to index.html)\n- **Deployment Command**: `npm run deploy` builds and deploys to Firebase\n\n## External Dependencies\n\n### Firebase Services\n- **Firebase Authentication**: User sign-in/sign-up\n- **Cloud Firestore**: NoSQL database for user data and premium status\n- **Firebase Storage**: File uploads for Media Vault feature (tickets, photos, documents)\n- **Firebase Hosting**: Static file hosting with CDN\n- **Cloud Functions**: Serverless backend for Stripe integration and push notifications\n- **Firebase Cloud Messaging (FCM)**: Push notifications for Road Ready squad alerts (premium feature)\n\n### Stripe Integration\n- **Purpose**: Premium subscription payments\n- **Configuration**: Secrets managed via Firebase Functions secrets\n  - `STRIPE_SECRET_KEY`: API key for Stripe\n  - `STRIPE_WEBHOOK_SECRET`: Webhook signature verification\n- **API Version**: 2024-04-10\n\n### NPM Packages (Frontend)\n- `firebase`: ^10.7.1 - Firebase SDK\n- `react` / `react-dom`: ^18.2.0 - UI framework\n- `lucide-react`: ^0.303.0 - Icon library\n- `clsx`: ^2.1.0 - Class name utility\n- `tailwind-merge`: ^2.2.0 - Tailwind class merging\n\n### NPM Packages (Cloud Functions)\n- `firebase-admin`: ^13.6.0 - Admin SDK\n- `firebase-functions`: ^7.0.1 - Functions framework\n- `stripe`: ^16.12.0 - Stripe API client","path":null,"size_bytes":7499,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}","path":null,"size_bytes":79,"size_tokens":null},"src/carnivals.js":{"content":"export const carnivalData = [\n    // --- December 2025 ---\n    { name: \"Sugar Mas (St. Kitts & Nevis)\", date: \"2025-12-12\" },\n    { name: \"Montserrat Carnival\", date: \"2025-12-20\" },\n    // Adinkra Carnival (Ghana) is Cancelled, so it is omitted from the countdown.\n  \n    // --- January 2026 ---\n    { name: \"St. Croix Festival\", date: \"2026-01-03\" },\n  \n    // --- February 2026 ---\n    { name: \"Carnaval Ponceno (Puerto Rico)\", date: \"2026-02-12\" },\n    { name: \"Aruba Carnival\", date: \"2026-02-14\" },\n    { name: \"Barranquilla Carnival (Colombia)\", date: \"2026-02-14\" },\n    { name: \"Martinique Carnival\", date: \"2026-02-15\" },\n    { name: \"Rio Carnival (Brazil)\", date: \"2026-02-15\" },\n    { name: \"Carnaval De Saint-Martin\", date: \"2026-02-15\" },\n    { name: \"Mas Domnik (Dominica)\", date: \"2026-02-16\" },\n    { name: \"Carriacou & Petite Martinique\", date: \"2026-02-16\" },\n    { name: \"Venezuela Carnival\", date: \"2026-02-16\" },\n    { name: \"Trinidad Carnival\", date: \"2026-02-16\" },\n    { name: \"Guyana Mashramani\", date: \"2026-02-23\" },\n    { name: \"Carnaval De San Pedro (Belize)\", date: \"2026-02-23\" },\n    { name: \"Guyana Independence\", date: \"2026-05-26\" },\n  \n    // --- March 2026 ---\n    { name: \"Cape Town Carnival (South Africa)\", date: \"2026-03-21\" },\n  \n    // --- April 2026 ---\n    { name: \"Virgin Gorda Easter Festival\", date: \"2026-04-05\" },\n    { name: \"St. Maarten Carnival\", date: \"2026-04-10\" },\n    { name: \"Jamaica Carnival\", date: \"2026-04-12\" },\n    { name: \"Tampa Bay Carnival (USA)\", date: \"2026-04-17\" },\n  \n    // --- May 2026 ---\n    { name: \"Cayman Carnival Batabano\", date: \"2026-05-09\" },\n    { name: \"Braccanal (Cayman Islands)\", date: \"2026-05-13\" },\n    { name: \"Berlin Carnival (Germany)\", date: \"2026-05-22\" },\n    { name: \"Atlanta Caribbean Carnival\", date: \"2026-05-23\" },\n    { name: \"Aalborg Karneval (Denmark)\", date: \"2026-05-23\" },\n    { name: \"Orlando Carnival\", date: \"2026-05-24\" },\n    { name: \"Luton International Carnival (UK)\", date: \"2026-05-24\" },\n  \n    // --- June 2026 ---\n    { name: \"Munich Carnival (Germany)\", date: \"2026-06-04\" },\n    { name: \"Bahamas Carnival\", date: \"2026-06-06\" },\n    { name: \"Bermuda Carnival\", date: \"2026-06-10\" },\n    { name: \"South Carolina Carnival\", date: \"2026-06-11\" },\n    { name: \"Caymas Carnival (Cayman Islands)\", date: \"2026-06-20\" },\n    { name: \"Philadelphia Carnival\", date: \"2026-06-20\" },\n    { name: \"Vincy Mas (St. Vincent)\", date: \"2026-06-26\" },\n    { name: \"Vienna Carnival (Austria)\", date: \"2026-06-26\" },\n  \n    // --- July 2026 ---\n    { name: \"Saint Lucia Carnival\", date: \"2026-07-20\" },\n    { name: \"Nevis Culturama Festival\", date: \"2026-07-23\" },\n    { name: \"Anguilla Summer Festival\", date: \"2026-07-24\" },\n    { name: \"Zomercarnaval (Rotterdam)\", date: \"2026-07-25\" },\n  \n    // --- August 2026 ---\n    { name: \"Crop Over (Barbados)\", date: \"2026-08-03\" },\n    { name: \"Antigua Carnival\", date: \"2026-08-03\" },\n    { name: \"Cariwest (Canada)\", date: \"2026-08-07\" },\n    { name: \"Toronto Caribbean Carnival (Caribana)\", date: \"2026-08-08\" },\n    { name: \"St. Thomas Carnival (USVI)\", date: \"2026-08-09\" },\n    { name: \"Spice Mas (Grenada)\", date: \"2026-08-10\" },\n    { name: \"Notting Hill Carnival (London)\", date: \"2026-08-31\" },\n  \n    // --- September 2026 ---\n    { name: \"New York Carnival (Labor Day)\", date: \"2026-09-07\" },\n    { name: \"Japan Caribbean Carnival\", date: \"2026-09-19\" },\n  \n    // --- October 2026 ---\n    { name: \"Miami Carnival\", date: \"2026-10-11\" },\n    { name: \"Tobago Carnival\", date: \"2026-10-30\" }\n  ];","path":null,"size_bytes":3556,"size_tokens":null},"src/index.css":{"content":"/* index.css */\n/* Tailwind base/components/utilities imports here */\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* iPhone Safe Area Support */\n@supports (padding: env(safe-area-inset-top)) {\n  html {\n    --sat: env(safe-area-inset-top);\n    --sar: env(safe-area-inset-right);\n    --sab: env(safe-area-inset-bottom);\n    --sal: env(safe-area-inset-left);\n  }\n}\n\n/* Custom scrollbar hide utility */\n.scrollbar-hide {\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n.scrollbar-hide::-webkit-scrollbar {\n  display: none;\n}\n\nbody {\n  /* New background gradient for glassmorphism backdrop */\n  background: linear-gradient(135deg, #3a1c71, #d76d77, #ffaf7b);\n  background-size: cover;\n  background-attachment: fixed;\n  min-height: 100vh;\n  min-height: -webkit-fill-available;\n}\n\n/* Safe area utilities for iPhone notch and home indicator */\n.safe-top {\n  padding-top: env(safe-area-inset-top);\n}\n.safe-bottom {\n  padding-bottom: env(safe-area-inset-bottom);\n}\n.safe-x {\n  padding-left: env(safe-area-inset-left);\n  padding-right: env(safe-area-inset-right);\n}\n\n/* Leaflet map fixes */\n.leaflet-container {\n  height: 100%;\n  width: 100%;\n  z-index: 1;\n}\n\n.custom-marker {\n  background: transparent;\n  border: none;\n}\n\n/* Toast animation */\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n.animate-slideIn {\n  animation: slideIn 0.3s ease-out forwards;\n}\n","path":null,"size_bytes":1466,"size_tokens":null},"functions2/index.js":{"content":"// Cloud Functions entry point for Carnival Planner premium subscriptions.\n\nconst functions = require(\"firebase-functions\");\nconst { onCall, HttpsError } = require(\"firebase-functions/v2/https\");\nconst admin = require(\"firebase-admin\");\nconst { getFirestore, FieldValue } = require(\"firebase-admin/firestore\");\nconst Stripe = require(\"stripe\");\n\nconst app = admin.initializeApp();\n\nconst APP_ID = \"carnival-planner-v1\";\n\nconst stripeSecretKey = process.env.STRIPE_SECRET_KEY || null;\nconst webhookSecret = process.env.STRIPE_WEBHOOK_SECRET || null;\n\nlet stripe = null;\nif (stripeSecretKey) {\n  stripe = new Stripe(stripeSecretKey, {\n    apiVersion: \"2024-04-10\",\n  });\n} else {\n  console.warn(\n    \"Stripe secret key is not set. Run:\\n\" +\n      \"firebase functions:secrets:set STRIPE_SECRET_KEY\"\n  );\n}\n\nif (!webhookSecret) {\n  console.warn(\n    \"Stripe webhook secret not set. Run:\\n\" +\n      \"firebase functions:secrets:set STRIPE_WEBHOOK_SECRET\"\n  );\n}\n\n// Use the squad-db (Native Mode) for squad operations\n// Pass both app and database ID to ensure correct database is used\nconst squadDb = getFirestore(app, 'squad-db');\n\n// ----- Callable: createCheckoutSession (v1 for Stripe compatibility) -----\nexports.createCheckoutSession = functions.https.onCall(\n  async (data, context) => {\n    const { \n      priceId, \n      uid: uidFromClient, \n      email: emailFromClient,\n      success_url,\n      cancel_url\n    } = data || {};\n\n    const uid = (context.auth && context.auth.uid) || uidFromClient;\n    const email =\n      (context.auth &&\n        context.auth.token &&\n        context.auth.token.email) ||\n      emailFromClient;\n\n    if (!priceId || typeof priceId !== \"string\") {\n      throw new functions.https.HttpsError(\n        \"invalid-argument\",\n        \"A valid Stripe priceId string is required.\"\n      );\n    }\n\n    if (!stripe) {\n      throw new functions.https.HttpsError(\n        \"failed-precondition\",\n        \"Stripe is not configured on the server.\"\n      );\n    }\n\n    const DEFAULT_ORIGIN = \"https://carnival-planner.web.app\";\n    const origin = success_url || DEFAULT_ORIGIN;\n    const cancelOrigin = cancel_url || DEFAULT_ORIGIN;\n    const finalSuccessUrl = `${origin}/premium-success?session_id={CHECKOUT_SESSION_ID}`;\n    const finalCancelUrl = `${cancelOrigin}/premium-cancel`;\n\n    try {\n      const session = await stripe.checkout.sessions.create({\n        mode: \"subscription\",\n        payment_method_types: [\"card\"],\n        customer_email: email || undefined,\n        line_items: [{ price: priceId, quantity: 1 }],\n        metadata: {\n          ...(uid ? { firebaseUid: uid } : {}),\n          priceId,\n          appId: APP_ID,\n        },\n        subscription_data: {\n          metadata: {\n            ...(uid ? { firebaseUid: uid } : {}),\n            priceId,\n            appId: APP_ID,\n          },\n        },\n        success_url: finalSuccessUrl,\n        cancel_url: finalCancelUrl,\n      });\n\n      return {\n        sessionId: session.id,\n        checkoutUrl: session.url,\n        url: session.url\n      };\n    } catch (err) {\n      console.error(\"Error creating Stripe Checkout session:\", err);\n      throw new functions.https.HttpsError(\n        \"internal\",\n        `Unable to create Stripe Checkout session: ${err.message}`\n      );\n    }\n  }\n);\n\n// ----- Webhook: handleStripeWebhook -----\nexports.handleStripeWebhook = functions.https.onRequest(\n  async (req, res) => {\n    if (req.method !== \"POST\") {\n      res.status(405).send(\"Method Not Allowed\");\n      return;\n    }\n\n    if (!stripe || !webhookSecret) {\n      console.error(\"Stripe not configured. Cannot handle webhook.\");\n      res.status(500).send(\"Stripe not configured.\");\n      return;\n    }\n\n    const sig = req.headers[\"stripe-signature\"];\n    let event;\n\n    try {\n      event = stripe.webhooks.constructEvent(req.rawBody, sig, webhookSecret);\n    } catch (err) {\n      console.error(\"Webhook signature verification failed:\", err.message);\n      res.status(400).send(`Webhook Error: ${err.message}`);\n      return;\n    }\n\n    try {\n      switch (event.type) {\n        case \"checkout.session.completed\": {\n          const session = event.data.object;\n          const meta = session.metadata || {};\n          const uid = meta.firebaseUid;\n          const priceId = meta.priceId || null;\n\n          if (!uid) break;\n\n          const subscriptionId = session.subscription;\n          const customerId = session.customer;\n          let currentPeriodEnd = null;\n          let status = \"active\";\n\n          if (subscriptionId) {\n            const sub = await stripe.subscriptions.retrieve(subscriptionId);\n            status = sub.status;\n            currentPeriodEnd = sub.current_period_end\n              ? new Date(sub.current_period_end * 1000)\n              : null;\n          }\n\n          // Store premium status in squad-db\n          const userAppRef = squadDb.doc(`users/${uid}/apps/${APP_ID}`);\n          await userAppRef.set({\n            premiumActive: true,\n            premiumUpdatedAt: FieldValue.serverTimestamp(),\n            premiumPriceId: priceId,\n            stripeCustomerId: customerId,\n            stripeSubscriptionId: subscriptionId,\n            premiumCurrentPeriodEnd: currentPeriodEnd,\n            subscriptionStatus: status,\n          }, { merge: true });\n\n          break;\n        }\n\n        case \"customer.subscription.updated\":\n        case \"customer.subscription.deleted\": {\n          const subscription = event.data.object;\n          const meta = subscription.metadata || {};\n          const uid = meta.firebaseUid;\n          const priceId = meta.priceId || null;\n\n          if (!uid) break;\n\n          const active =\n            subscription.status === \"active\" ||\n            subscription.status === \"trialing\";\n\n          const currentPeriodEnd = subscription.current_period_end\n            ? new Date(subscription.current_period_end * 1000)\n            : null;\n\n          const userAppRef = squadDb.doc(`users/${uid}/apps/${APP_ID}`);\n          await userAppRef.set({\n            premiumActive: active,\n            premiumUpdatedAt: FieldValue.serverTimestamp(),\n            premiumPriceId: priceId,\n            stripeCustomerId: subscription.customer,\n            stripeSubscriptionId: subscription.id,\n            premiumCurrentPeriodEnd: currentPeriodEnd,\n            subscriptionStatus: subscription.status,\n          }, { merge: true });\n\n          break;\n        }\n\n        default:\n          console.log(`Unhandled event type ${event.type}`);\n      }\n\n      res.json({ received: true });\n    } catch (err) {\n      console.error(\"Webhook handler error:\", err);\n      res.status(500).send(\"Webhook handler failed.\");\n    }\n  }\n);\n\n// ----- Squad Sharing Functions (v2 with public invoker) -----\n\nfunction generateShareCode() {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n  let code = '';\n  for (let i = 0; i < 6; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n\nexports.createSquadShareCode = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { carnivalId, carnivalName, uid: uidFromClient } = request.data || {};\n    const uid = (request.auth && request.auth.uid) || uidFromClient;\n    \n    if (!uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    if (!carnivalId) {\n      throw new HttpsError('invalid-argument', 'Carnival ID required.');\n    }\n    \n    const sharedPlansRef = squadDb.collection('sharedPlans');\n    \n    // Query by ownerId only, then filter by carnivalId in code\n    const existingQuery = await sharedPlansRef\n      .where('ownerId', '==', uid)\n      .get();\n    \n    // Filter for matching carnivalId\n    const matchingPlan = existingQuery.docs.find(doc => doc.data().carnivalId === carnivalId);\n    \n    if (matchingPlan) {\n      return { \n        shareCode: matchingPlan.data().shareCode,\n        planId: matchingPlan.id\n      };\n    }\n    \n    const shareCode = generateShareCode();\n    const now = new Date();\n    const planRef = await sharedPlansRef.add({\n      ownerId: uid,\n      carnivalId,\n      carnivalName: carnivalName || carnivalId,\n      shareCode,\n      members: [{\n        uid,\n        role: 'owner',\n        joinedAt: now\n      }],\n      createdAt: now\n    });\n    \n    return { shareCode, planId: planRef.id };\n  }\n);\n\nexports.joinSquadByCode = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { shareCode, uid: uidFromClient, email: emailFromClient } = request.data || {};\n    const uid = (request.auth && request.auth.uid) || uidFromClient;\n    const email = (request.auth && request.auth.token && request.auth.token.email) || emailFromClient;\n    \n    if (!uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    if (!shareCode || shareCode.length !== 6) {\n      throw new HttpsError('invalid-argument', 'Valid 6-character share code required.');\n    }\n    \n    const sharedPlansRef = squadDb.collection('sharedPlans');\n    const query = await sharedPlansRef\n      .where('shareCode', '==', shareCode.toUpperCase())\n      .limit(1)\n      .get();\n    \n    if (query.empty) {\n      throw new HttpsError('not-found', 'Invalid share code.');\n    }\n    \n    const planDoc = query.docs[0];\n    const planData = planDoc.data();\n    \n    const isAlreadyMember = planData.members?.some(m => m.uid === uid);\n    if (isAlreadyMember) {\n      return { \n        success: true, \n        message: 'Already a member',\n        planId: planDoc.id,\n        carnivalName: planData.carnivalName\n      };\n    }\n    \n    const updatedMembers = [...(planData.members || []), {\n      uid,\n      email: email || null,\n      role: 'member',\n      joinedAt: new Date()\n    }];\n    await planDoc.ref.update({ members: updatedMembers });\n    \n    return { \n      success: true, \n      message: 'Joined squad!',\n      planId: planDoc.id,\n      carnivalName: planData.carnivalName,\n      ownerId: planData.ownerId\n    };\n  }\n);\n\nexports.getSharedPlanData = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { planId, uid: uidFromClient } = request.data || {};\n    const uid = (request.auth && request.auth.uid) || uidFromClient;\n    \n    if (!uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    if (!planId) {\n      throw new HttpsError('invalid-argument', 'Plan ID required.');\n    }\n    \n    const planDoc = await squadDb.collection('sharedPlans').doc(planId).get();\n    \n    if (!planDoc.exists) {\n      throw new HttpsError('not-found', 'Plan not found.');\n    }\n    \n    const planData = planDoc.data();\n    \n    const isMember = planData.members?.some(m => m.uid === uid);\n    if (!isMember) {\n      throw new HttpsError('permission-denied', 'Not a member of this squad.');\n    }\n    \n    return {\n      planId: planDoc.id,\n      ...planData\n    };\n  }\n);\n\nexports.leaveSquad = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { planId, uid: uidFromClient } = request.data || {};\n    const uid = (request.auth && request.auth.uid) || uidFromClient;\n    \n    if (!uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    if (!planId) {\n      throw new HttpsError('invalid-argument', 'Plan ID required.');\n    }\n    \n    const planRef = squadDb.collection('sharedPlans').doc(planId);\n    const planDoc = await planRef.get();\n    \n    if (!planDoc.exists) {\n      throw new HttpsError('not-found', 'Plan not found.');\n    }\n    \n    const planData = planDoc.data();\n    \n    if (planData.ownerId === uid) {\n      throw new HttpsError('failed-precondition', 'Owner cannot leave. Transfer ownership or delete the squad.');\n    }\n    \n    const updatedMembers = (planData.members || []).filter(m => m.uid !== uid);\n    await planRef.update({ members: updatedMembers });\n    \n    return { success: true };\n  }\n);\n\nexports.getMySquads = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { uid: uidFromClient } = request.data || {};\n    const uid = (request.auth && request.auth.uid) || uidFromClient;\n    \n    if (!uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    const sharedPlansRef = squadDb.collection('sharedPlans');\n    const snapshot = await sharedPlansRef.get();\n    \n    const mySquads = [];\n    snapshot.forEach(doc => {\n      const data = doc.data();\n      const isMember = data.members?.some(m => m.uid === uid);\n      if (isMember) {\n        mySquads.push({\n          planId: doc.id,\n          carnivalId: data.carnivalId,\n          carnivalName: data.carnivalName,\n          shareCode: data.shareCode,\n          memberCount: data.members?.length || 0,\n          isOwner: data.ownerId === uid\n        });\n      }\n    });\n    \n    return { squads: mySquads };\n  }\n);\n\n// ----- FCM Token Management -----\n\nexports.saveFcmToken = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { fcmToken } = request.data || {};\n    \n    if (!request.auth || !request.auth.uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    const uid = request.auth.uid;\n    \n    if (!fcmToken) {\n      throw new HttpsError('invalid-argument', 'FCM token required.');\n    }\n    \n    const tokenRef = squadDb.collection('fcmTokens').doc(uid);\n    await tokenRef.set({\n      token: fcmToken,\n      updatedAt: new Date()\n    }, { merge: true });\n    \n    return { success: true };\n  }\n);\n\n// ----- Road Ready Notification (Premium Feature) -----\n\nexports.sendRoadReadyAlert = onCall(\n  { cors: true, invoker: \"public\" },\n  async (request) => {\n    const { \n      carnivalId, \n      carnivalName,\n      userName\n    } = request.data || {};\n    \n    if (!request.auth || !request.auth.uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in.');\n    }\n    \n    const uid = request.auth.uid;\n    \n    if (!carnivalId) {\n      throw new HttpsError('invalid-argument', 'Carnival ID required.');\n    }\n    \n    // Check if user has premium access (server-side enforcement)\n    const userAppRef = squadDb.doc(`users/${uid}/apps/${APP_ID}`);\n    const userAppDoc = await userAppRef.get();\n    \n    // Also check for superuser (djkrss1@gmail.com) by checking if email matches\n    const userEmail = request.auth.token?.email || '';\n    const isSuperuser = userEmail === 'djkrss1@gmail.com';\n    const isPremium = isSuperuser || (userAppDoc.exists && userAppDoc.data()?.premiumActive === true);\n    \n    if (!isPremium) {\n      throw new HttpsError('permission-denied', 'Road Ready alerts require premium subscription.');\n    }\n    \n    // Find all squads for this carnival where user is a member\n    const sharedPlansRef = squadDb.collection('sharedPlans');\n    const snapshot = await sharedPlansRef.get();\n    \n    const squadMemberUids = new Set();\n    snapshot.forEach(doc => {\n      const data = doc.data();\n      if (data.carnivalId === carnivalId) {\n        const isMember = data.members?.some(m => m.uid === uid);\n        if (isMember) {\n          data.members.forEach(m => {\n            if (m.uid !== uid) {\n              squadMemberUids.add(m.uid);\n            }\n          });\n        }\n      }\n    });\n    \n    if (squadMemberUids.size === 0) {\n      return { success: true, notified: 0, message: 'No squad members to notify.' };\n    }\n    \n    // Get FCM tokens for all squad members\n    const fcmTokensRef = squadDb.collection('fcmTokens');\n    const tokens = [];\n    \n    for (const memberUid of squadMemberUids) {\n      const tokenDoc = await fcmTokensRef.doc(memberUid).get();\n      if (tokenDoc.exists && tokenDoc.data()?.token) {\n        tokens.push(tokenDoc.data().token);\n      }\n    }\n    \n    if (tokens.length === 0) {\n      return { success: true, notified: 0, message: 'No squad members with notifications enabled.' };\n    }\n    \n    // Send push notifications\n    const displayName = userName || 'A squad member';\n    const message = {\n      notification: {\n        title: `${displayName} is Road Ready!`,\n        body: `Ready to party at ${carnivalName || carnivalId}! Time to link up!`\n      },\n      data: {\n        type: 'road_ready',\n        carnivalId,\n        senderUid: uid\n      },\n      tokens\n    };\n    \n    try {\n      const response = await admin.messaging().sendEachForMulticast(message);\n      console.log(`Road Ready notifications sent: ${response.successCount} success, ${response.failureCount} failed`);\n      \n      return { \n        success: true, \n        notified: response.successCount,\n        message: `Notified ${response.successCount} squad member(s)!`\n      };\n    } catch (err) {\n      console.error('Error sending Road Ready notifications:', err);\n      throw new HttpsError('internal', 'Failed to send notifications.');\n    }\n  }\n);\n\n// ----- Callable: deleteUserAccount -----\n// Deletes all user data from Firestore, Storage, and Auth\nexports.deleteUserAccount = onCall(\n  { \n    region: \"us-central1\",\n    enforceAppCheck: false\n  },\n  async (request) => {\n    if (!request.auth || !request.auth.uid) {\n      throw new HttpsError('unauthenticated', 'Must be signed in to delete account.');\n    }\n    \n    const uid = request.auth.uid;\n    const userEmail = request.auth.token?.email || '';\n    \n    console.log(`Deleting account for user: ${uid} (${userEmail})`);\n    \n    try {\n      // 1. Delete all carnival data under users/{uid}/apps/{APP_ID}/carnivals/*\n      const carnivalsRef = squadDb.collection(`users/${uid}/apps/${APP_ID}/carnivals`);\n      const carnivalsSnapshot = await carnivalsRef.get();\n      const carnivalDeletes = carnivalsSnapshot.docs.map(doc => doc.ref.delete());\n      await Promise.all(carnivalDeletes);\n      console.log(`Deleted ${carnivalsSnapshot.docs.length} carnival documents`);\n      \n      // 2. Delete the app document users/{uid}/apps/{APP_ID}\n      const appRef = squadDb.doc(`users/${uid}/apps/${APP_ID}`);\n      await appRef.delete();\n      console.log('Deleted app document');\n      \n      // 3. Delete the user document users/{uid}\n      const userRef = squadDb.doc(`users/${uid}`);\n      await userRef.delete();\n      console.log('Deleted user document');\n      \n      // 4. Delete FCM token\n      const fcmRef = squadDb.doc(`fcmTokens/${uid}`);\n      await fcmRef.delete();\n      console.log('Deleted FCM token');\n      \n      // 5. Delete files from Firebase Storage (if any)\n      try {\n        const bucket = admin.storage().bucket();\n        const [files] = await bucket.getFiles({ prefix: `users/${uid}/` });\n        if (files.length > 0) {\n          await Promise.all(files.map(file => file.delete()));\n          console.log(`Deleted ${files.length} storage files`);\n        }\n      } catch (storageErr) {\n        console.log('Storage deletion skipped (no files or error):', storageErr.message);\n      }\n      \n      // 6. Remove user from any shared plans\n      const sharedPlansRef = squadDb.collection('sharedPlans');\n      const plansSnapshot = await sharedPlansRef.get();\n      const planUpdates = [];\n      \n      plansSnapshot.forEach(doc => {\n        const data = doc.data();\n        if (data.members?.some(m => m.uid === uid)) {\n          const updatedMembers = data.members.filter(m => m.uid !== uid);\n          planUpdates.push(doc.ref.update({ members: updatedMembers }));\n        }\n        if (data.ownerUid === uid) {\n          planUpdates.push(doc.ref.delete());\n        }\n      });\n      await Promise.all(planUpdates);\n      console.log('Removed user from shared plans');\n      \n      // 7. Delete the Firebase Auth user account\n      await admin.auth().deleteUser(uid);\n      console.log('Deleted Auth user');\n      \n      return { \n        success: true, \n        message: 'Account and all data deleted successfully.' \n      };\n    } catch (err) {\n      console.error('Error deleting user account:', err);\n      throw new HttpsError('internal', 'Failed to delete account. Please try again.');\n    }\n  }\n);\n","path":null,"size_bytes":19920,"size_tokens":null},"src/firebase.js":{"content":"import { initializeApp } from \"firebase/app\";\nimport { getAuth } from \"firebase/auth\";\nimport { getFirestore, enableIndexedDbPersistence } from \"firebase/firestore\";\nimport { getStorage } from \"firebase/storage\";\nimport { getMessaging, getToken, onMessage, isSupported } from \"firebase/messaging\";\n\n// --- PASTE YOUR KEYS HERE ---\nconst firebaseConfig = {\n  apiKey: \"AIzaSyCWp0X6bLJBsyYKTjUaVsXBSuVD8KeeEqY\",\n  authDomain: \"carnival-planner.firebaseapp.com\",\n  projectId: \"carnival-planner\",\n  storageBucket: \"carnival-planner.firebasestorage.app\",\n  messagingSenderId: \"1036340118282\",\n  appId: \"1:1036340118282:web:809dc12c298ff1b8f2f0f3\",\n  measurementId: \"G-XC1K69PSVC\"\n};\n// ----------------------------\n\nconst app = initializeApp(firebaseConfig);\n\n// EXPORT these services so App.jsx can use them\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const storage = getStorage(app);\n\n// Enable offline persistence immediately at startup (before any Firestore operations)\n// This enables caching for all users, but the premium UI features control access\nenableIndexedDbPersistence(db).then(() => {\n  console.log('Offline persistence enabled');\n}).catch((err) => {\n  if (err.code === 'failed-precondition') {\n    console.log('Offline persistence unavailable: Multiple tabs open');\n  } else if (err.code === 'unimplemented') {\n    console.log('Offline persistence not supported in this browser');\n  }\n});\n\n// Firebase Cloud Messaging for push notifications\nlet messaging = null;\n\n// Initialize messaging only if supported\nconst initMessaging = async () => {\n  try {\n    const supported = await isSupported();\n    if (supported) {\n      messaging = getMessaging(app);\n      console.log('Firebase Messaging initialized');\n      return messaging;\n    } else {\n      console.log('Firebase Messaging not supported in this browser');\n      return null;\n    }\n  } catch (err) {\n    console.log('Error initializing Firebase Messaging:', err);\n    return null;\n  }\n};\n\n// Request permission and get FCM token\nexport const requestNotificationPermission = async (vapidKey) => {\n  try {\n    const permission = await Notification.requestPermission();\n    if (permission !== 'granted') {\n      console.log('Notification permission denied');\n      return null;\n    }\n    \n    if (!messaging) {\n      await initMessaging();\n    }\n    \n    if (!messaging) {\n      return null;\n    }\n    \n    const token = await getToken(messaging, { vapidKey });\n    console.log('FCM Token:', token);\n    return token;\n  } catch (err) {\n    console.log('Error getting FCM token:', err);\n    return null;\n  }\n};\n\n// Listen for foreground messages\nexport const onForegroundMessage = (callback) => {\n  if (!messaging) {\n    initMessaging().then(() => {\n      if (messaging) {\n        onMessage(messaging, callback);\n      }\n    });\n  } else {\n    onMessage(messaging, callback);\n  }\n};\n\n// Initialize messaging on module load\ninitMessaging();\n\nexport default app;","path":null,"size_bytes":2955,"size_tokens":null},"functions2/testCheckout.js":{"content":"const functions = require('firebase-functions');\nconst admin = require('firebase-admin');\nconst Stripe = require('stripe');\n\nadmin.initializeApp();\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: '2024-04-10',\n});\n\nexports.testReceivePriceId = functions.https.onRequest(async (req, res) => {\n  const { priceId, billingInterval } = req.body;\n\n  if (!priceId) {\n    console.warn(\"‚ùå No priceId received.\");\n    return res.status(400).json({ error: \"Missing priceId\" });\n  }\n\n  console.log(\"‚úÖ Received priceId:\", priceId);\n  console.log(\"‚ÑπÔ∏è Billing Interval:\", billingInterval || \"not provided\");\n\n  // Optionally create a dummy checkout session\n  try {\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: ['card'],\n      line_items: [{\n        price: priceId,\n        quantity: 1,\n      }],\n      mode: 'subscription',\n      success_url: 'https://example.com/success',\n      cancel_url: 'https://example.com/cancel',\n    });\n\n    return res.status(200).json({\n      message: \"Stripe session created\",\n      sessionId: session.id,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Stripe error:\", error.message);\n    return res.status(500).json({ error: error.message });\n  }\n});\n","path":null,"size_bytes":1247,"size_tokens":null},"vite.config.js":{"content":"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    allowedHosts: true\n  },\n  build: {\n    outDir: 'dist',\n    sourcemap: false\n  }\n})","path":null,"size_bytes":265,"size_tokens":null},"tailwind.config.js":{"content":"/** @type {import('tailwindcss').Config} */\nexport default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,jsx,ts,tsx}\",\n  ],\n  darkMode: 'class', // üëà Enables manual dark mode toggling\n  theme: {\n    extend: {},\n  },\n  safelist: [\n    {\n      pattern: /(bg|text|border)-(teal|yellow|blue|orange|red|green|slate)-(50|100|200|500|600|700|800)/,\n      variants: [\"hover\", \"focus\", \"dark\"], // Added dark variant\n    },\n    'bg-gradient-to-r',\n    'from-indigo-500', 'via-purple-500', 'to-pink-500',\n    'from-green-400', 'to-blue-500',\n    'from-yellow-400', 'via-red-500', 'to-pink-500',\n    'from-teal-400', 'to-cyan-500',\n    'from-red-500', 'via-orange-500', 'to-yellow-500',\n    'from-purple-600', 'to-indigo-600',\n    'backdrop-blur-md',\n  ],\n  plugins: [],\n};","path":null,"size_bytes":774,"size_tokens":null},"src/main.jsx":{"content":"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport './index.css'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n);\n\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n      .then((registration) => {\n        console.log('SW registered:', registration.scope);\n      })\n      .catch((error) => {\n        console.log('SW registration failed:', error);\n      });\n  });\n}\n\n//","path":null,"size_bytes":564,"size_tokens":null},"src/App.jsx":{"content":"import React, { useEffect, useState } from 'react';\nimport {\n  onAuthStateChanged,\n  GoogleAuthProvider,\n  signInWithPopup,\n  signOut as firebaseSignOut,\n  getRedirectResult,\n} from 'firebase/auth';\nimport {\n  collection,\n  doc,\n  setDoc,\n  updateDoc,\n  onSnapshot,\n  Timestamp,\n} from 'firebase/firestore';\nimport { getFunctions, httpsCallable } from 'firebase/functions';\nimport app, { auth, db, requestNotificationPermission, onForegroundMessage } from './firebase';\nimport logo from './assets/carnival-logo.png';\nimport { carnivalData } from './carnivals';\nimport FeteMap from './components/FeteMap';\nimport MediaVault from './components/MediaVault';\nimport PromoAd from './components/PromoAd';\nimport AdManager from './components/AdManager';\nimport SplashPage from './components/SplashPage';\nimport { PrivacyPolicy, TermsOfService, CookiePolicy, RefundPolicy } from './components/LegalPages';\nimport InstallPrompt from './components/InstallPrompt';\nimport { ContactPage, SupportAdmin } from './components/ContactSupport';\nimport AccountSettings from './components/AccountSettings';\nimport EmailAuthForm, { EmailVerificationBanner } from './components/EmailAuthForm';\n\n// --- CONFIGURATION ---\nconst appId = 'carnival-planner-v1';\n\n// ‚úÖ STRIPE PRICE IDs (Updated from your request)\nconst STRIPE_MONTHLY_PRICE_ID = 'price_1SanHUJR9xpdRiXijLesRPVt';\nconst STRIPE_YEARLY_PRICE_ID = 'price_1SanMhJR9xpdRiXinv2F9knM';\n\n// Curated Fete Database (Free for all users)\nconst POPULAR_EVENTS = {\n  trinidad: [\n    { title: \"Soca Brainwash\", note: \"The main event. Bring drinks.\" },\n    { title: \"AM Bush\", note: \"J'ouvert style. Wear old clothes.\" },\n    { title: \"Phuket\", note: \"All inclusive.\" },\n    { title: \"Soaka Street Festival\", note: \"Iron park.\" },\n  ],\n  stlucia: [\n    { title: \"Remedy\", note: \"Beachside.\" },\n    { title: \"Mess\", note: \"Paint and Powder.\" },\n    { title: \"Indulgence\", note: \"Breakfast fete.\" },\n  ],\n  default: [\n    { title: \"Catamaran Cruise\", note: \"Boat ride.\" },\n    { title: \"J'ouvert\", note: \"Paint and powder.\" },\n    { title: \"Monday Mas\", note: \"On the road.\" },\n  ]\n};\n\nexport default function App() {\n  // --- STATE ---\n  const [user, setUser] = useState(null);\n  \n  // Data\n  const [carnivals, setCarnivals] = useState({});\n  const [activeCarnivalId, setActiveCarnivalId] = useState(null);\n  const [activeTab, setActiveTab] = useState('Budget');\n  \n  // UI State\n  const [isPremium, setIsPremium] = useState(false);\n  const [showLanding, setShowLanding] = useState(true);\n  const [roadMode, setRoadMode] = useState(false);\n  const [darkMode, setDarkMode] = useState(false);\n  const [isCheckingOut, setIsCheckingOut] = useState(false);\n\n  // Form Inputs\n  const [newBudgetName, setNewBudgetName] = useState('');\n  const [newBudgetCost, setNewBudgetCost] = useState('');\n  const [newScheduleName, setNewScheduleName] = useState('');\n  const [newScheduleDate, setNewScheduleDate] = useState('');\n  const [newScheduleNote, setNewScheduleNote] = useState('');\n  const [newPackingItem, setNewPackingItem] = useState('');\n  \n  // Squad & Costume Forms\n  const [newSquadMember, setNewSquadMember] = useState('');\n  const [costumeDetails, setCostumeDetails] = useState({ band: '', section: '', total: '', paid: '' });\n\n  // Squad Sharing State\n  const [squadShareCode, setSquadShareCode] = useState('');\n  const [joinCode, setJoinCode] = useState('');\n  const [squadMembers, setSquadMembers] = useState([]);\n  const [isCreatingShare, setIsCreatingShare] = useState(false);\n  const [isJoiningSquad, setIsJoiningSquad] = useState(false);\n  const [squadShareError, setSquadShareError] = useState('');\n  const [squadShareSuccess, setSquadShareSuccess] = useState('');\n\n  // Notification State\n  const [toastMessage, setToastMessage] = useState(null);\n  const [notifySquadOnRoadReady, setNotifySquadOnRoadReady] = useState(true);\n  const [isSendingRoadReadyAlert, setIsSendingRoadReadyAlert] = useState(false);\n\n  // Legal Pages State\n  const [activeLegalPage, setActiveLegalPage] = useState(null);\n\n  // Email Auth State\n  const [showEmailAuth, setShowEmailAuth] = useState(false);\n\n  // --- CONFIG ---\n  const carnivalOptions = [\n    { id: 'trinidad', name: 'Trinidad Carnival', monthIndex: 1 },\n    { id: 'stkitts-sugar-mas', name: 'St. Kitts (Sugar Mas)', monthIndex: 0 },\n    { id: 'aruba', name: 'Aruba Carnival', monthIndex: 1 },\n    { id: 'guyana-mashramani', name: 'Guyana Mashramani', monthIndex: 1 },\n    { id: 'guyana-independence', name: 'Guyana Independence', monthIndex: 4 },\n    { id: 'jamaica', name: 'Jamaica Carnival', monthIndex: 3 },\n    { id: 'stmaarten', name: 'Maarten Carnival', monthIndex: 3 },\n    { id: 'bahamas', name: 'Bahamas Carnival', monthIndex: 5 },\n    { id: 'bermuda', name: 'Bermuda Carnival', monthIndex: 5 },\n    { id: 'vincymas', name: 'Vincy Mas', monthIndex: 6 },\n    { id: 'antigua', name: 'Antigua Carnival', monthIndex: 7 },\n    { id: 'stlucia', name: 'Lucia Carnival', monthIndex: 6 },\n    { id: 'tobago', name: 'Tobago Carnival', monthIndex: 9 },\n    { id: 'nottinghill', name: 'Notting Hill', monthIndex: 7 },\n    { id: 'miami', name: 'Miami Carnival', monthIndex: 9 },\n  ];\n\n  const gradientClasses = [\n    'bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500',\n    'bg-gradient-to-r from-green-400 to-blue-500',\n    'bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500',\n    'bg-gradient-to-r from-teal-400 to-cyan-500',\n    'bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500',\n    'bg-gradient-to-r from-purple-600 to-indigo-600',\n  ];\n\n  const monthNames = [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December',\n  ];\n\n  // --- EFFECTS ---\n\n  // 1. Dark Mode\n  useEffect(() => {\n    if (darkMode) {\n      document.documentElement.classList.add('dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n    }\n  }, [darkMode]);\n\n  // 2. Auth Listener\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (u) => setUser(u));\n    return () => unsubscribe();\n  }, []);\n\n  // 3. Premium Check (Firestore + Admin Override)\n  useEffect(() => {\n    if (!user) {\n      setIsPremium(false);\n      return;\n    }\n\n    // ‚≠ê SUPERUSER/PREMIUM OVERRIDE: Ensure these emails are always premium\n    const premiumEmails = ['djkrss1@gmail.com', 'maikacooke@gmail.com'];\n    if (premiumEmails.includes(user.email)) {\n      setIsPremium(true);\n    }\n\n    const appRef = doc(db, 'users', user.uid, 'apps', appId);\n    const unsub = onSnapshot(appRef, (snap) => {\n      // If user is in the premium override list, enforce true regardless of DB\n      if (premiumEmails.includes(user.email)) {\n        setIsPremium(true);\n        return;\n      }\n\n      if (snap.exists()) {\n        const data = snap.data();\n        setIsPremium(!!data.premiumActive);\n      } else {\n        setIsPremium(false);\n      }\n    });\n    return () => unsub();\n  }, [user]);\n\n  // 4. Load Carnivals\n  useEffect(() => {\n    if (!user) {\n      setCarnivals({});\n      setActiveCarnivalId(null);\n      return;\n    }\n    const carnivalsRef = collection(db, 'users', user.uid, 'apps', appId, 'carnivals');\n    const unsubscribe = onSnapshot(carnivalsRef, (snapshot) => {\n      const map = {};\n      snapshot.forEach((docSnap) => {\n        map[docSnap.id] = docSnap.data();\n      });\n      setCarnivals(map);\n      if (!activeCarnivalId && snapshot.docs.length > 0) {\n        setActiveCarnivalId(snapshot.docs[0].id);\n      }\n    });\n    return () => unsubscribe();\n  }, [user]);\n\n  useEffect(() => {\n    getRedirectResult(auth).catch((err) => console.error(err));\n  }, []);\n\n  // 5. Request notification permission and save FCM token\n  useEffect(() => {\n    if (!user) return;\n    \n    const setupNotifications = async () => {\n      try {\n        const vapidKey = 'BLbW7EjHjQ9_YjKrRbJwgBgRqnkSmZsXMnEWTQZpqYwSRbVgYLmXW5RvXA2_aS3vH9XJpCxHu4VmXnZL2wQxMvI';\n        const token = await requestNotificationPermission(vapidKey);\n        \n        if (token) {\n          const functions = getFunctions(app);\n          const saveFcmToken = httpsCallable(functions, 'saveFcmToken');\n          await saveFcmToken({ fcmToken: token });\n          console.log('FCM token saved');\n        }\n      } catch (err) {\n        console.log('Error setting up notifications:', err);\n      }\n    };\n    \n    setupNotifications();\n    \n    onForegroundMessage((payload) => {\n      console.log('Foreground message:', payload);\n      setToastMessage({\n        title: payload.notification?.title || 'Squad Alert',\n        body: payload.notification?.body || 'Someone in your squad is Road Ready!'\n      });\n      setTimeout(() => setToastMessage(null), 5000);\n    });\n  }, [user]);\n\n  // --- ACTIONS ---\n\n  const handleSignIn = async () => {\n    const provider = new GoogleAuthProvider();\n    try {\n      await signInWithPopup(auth, provider);\n    } catch (err) {\n      console.error('Sign in error:', err);\n    }\n  };\n\n  const handleSignOut = async () => {\n    await firebaseSignOut(auth);\n    setShowLanding(true);\n    setRoadMode(false);\n    setActiveTab('Budget');\n  };\n\n  // --- STRIPE SUBSCRIPTION ---\n  const handleSubscribe = async (interval) => {\n    if (!user) {\n      alert(\"You must be signed in to subscribe.\");\n      return;\n    }\n  \n    // Determine the Price ID\n    const billingInterval = interval === \"yearly\" ? \"yearly\" : \"monthly\";\n    const priceId = billingInterval === \"yearly\" ? STRIPE_YEARLY_PRICE_ID : STRIPE_MONTHLY_PRICE_ID;\n  \n    // Safety Check\n    if (!priceId) {\n      console.error(\"Price ID missing for interval:\", billingInterval);\n      alert(\"Premium pricing configuration error. Please contact support.\");\n      return;\n    }\n  \n    setIsCheckingOut(true);\n  \n    try {\n      // ‚úÖ Explicitly use 'app' to ensure correct instance\n      const functions = getFunctions(app);\n      const createCheckoutSession = httpsCallable(functions, \"createCheckoutSession\");\n      \n      console.log(`Starting checkout... Interval: ${billingInterval}, PriceID: ${priceId}`);\n\n      // ‚úÖ Send success_url and cancel_url\n      const result = await createCheckoutSession({ \n        priceId: priceId, // Ensure key is explicitly 'priceId'\n        success_url: window.location.origin, \n        cancel_url: window.location.origin\n      });\n      \n      const { data } = result || {};\n      \n      if (data && (data.url || data.checkoutUrl)) {\n        window.location.href = data.url || data.checkoutUrl; \n      } else {\n        console.error(\"No checkout URL returned:\", data);\n        alert(\"Unable to start checkout. Please try again.\");\n      }\n    } catch (error) {\n      console.error(\"Error starting checkout:\", error);\n      alert(\"There was a problem starting your checkout: \" + error.message);\n    } finally {\n      setIsCheckingOut(false);\n    }\n  };\n\n  const selectCarnival = async (id, name) => {\n    if (!user) return;\n    setActiveCarnivalId(id);\n    if (!carnivals[id]) {\n      try {\n        const ref = doc(db, 'users', user.uid, 'apps', appId, 'carnivals', id);\n        await setDoc(ref, {\n          name,\n          budget: [],\n          schedule: [],\n          packing: [],\n          squad: [],\n          costume: null,\n          createdAt: Timestamp.now(),\n        }, { merge: true });\n      } catch (err) {\n        console.error(err);\n      }\n    }\n  };\n\n  const updateCarnivalData = async (field, newData) => {\n    if (!user || !activeCarnivalId) return;\n    const ref = doc(db, 'users', user.uid, 'apps', appId, 'carnivals', activeCarnivalId);\n    await updateDoc(ref, { [field]: newData });\n  };\n\n  // --- FEATURE HANDLERS ---\n\n  const toggleRoadMode = async () => {\n    setRoadMode(true);\n    \n    if (isPremium && notifySquadOnRoadReady && currentCarnival) {\n      setIsSendingRoadReadyAlert(true);\n      try {\n        const functions = getFunctions(app);\n        const sendRoadReadyAlert = httpsCallable(functions, 'sendRoadReadyAlert');\n        const result = await sendRoadReadyAlert({\n          carnivalId: activeCarnivalId,\n          carnivalName: currentCarnival.name,\n          userName: user?.displayName || user?.email?.split('@')[0] || 'Squad Member'\n        });\n        \n        if (result.data?.notified > 0) {\n          setToastMessage({\n            title: 'Squad Notified!',\n            body: `${result.data.notified} squad member(s) alerted that you're Road Ready!`\n          });\n          setTimeout(() => setToastMessage(null), 5000);\n        }\n      } catch (err) {\n        console.log('Error sending Road Ready alert:', err);\n      } finally {\n        setIsSendingRoadReadyAlert(false);\n      }\n    }\n  };\n\n  const addBudgetItem = () => {\n    if (!newBudgetName.trim() || !newBudgetCost) return;\n    const items = carnivals[activeCarnivalId]?.budget || [];\n    const newItem = { id: Date.now().toString(), name: newBudgetName.trim(), cost: parseFloat(newBudgetCost) };\n    updateCarnivalData('budget', [...items, newItem]);\n    setNewBudgetName('');\n    setNewBudgetCost('');\n  };\n  const removeBudgetItem = (id) => {\n    const items = carnivals[activeCarnivalId]?.budget || [];\n    updateCarnivalData('budget', items.filter(i => i.id !== id));\n  };\n\n  const addScheduleItem = () => {\n    if (!newScheduleName.trim() || !newScheduleDate) return;\n    const items = carnivals[activeCarnivalId]?.schedule || [];\n    const newItem = { \n      id: Date.now().toString(), \n      title: newScheduleName.trim(), \n      datetime: newScheduleDate, \n      note: newScheduleNote.trim() \n    };\n    updateCarnivalData('schedule', [...items, newItem]);\n    setNewScheduleName('');\n    setNewScheduleDate('');\n    setNewScheduleNote('');\n  };\n  const removeScheduleItem = (id) => {\n    const items = carnivals[activeCarnivalId]?.schedule || [];\n    updateCarnivalData('schedule', items.filter(i => i.id !== id));\n  };\n\n  const addCuratedEvent = (evt) => {\n    const items = carnivals[activeCarnivalId]?.schedule || [];\n    const defaultDate = new Date();\n    defaultDate.setDate(defaultDate.getDate() + 1);\n    defaultDate.setHours(12, 0, 0, 0);\n    const dateStr = defaultDate.toISOString().slice(0, 16);\n\n    const newItem = {\n      id: Date.now().toString(),\n      title: evt.title,\n      datetime: dateStr,\n      note: evt.note || \"Added from curated list\"\n    };\n    updateCarnivalData('schedule', [...items, newItem]);\n  };\n\n  const addPackingItem = () => {\n    if (!newPackingItem.trim()) return;\n    const items = carnivals[activeCarnivalId]?.packing || [];\n    const newItem = { id: Date.now().toString(), item: newPackingItem.trim(), checked: false };\n    updateCarnivalData('packing', [...items, newItem]);\n    setNewPackingItem('');\n  };\n  const togglePackingItem = (id) => {\n    const items = carnivals[activeCarnivalId]?.packing || [];\n    updateCarnivalData('packing', items.map(i => i.id === id ? { ...i, checked: !i.checked } : i));\n  };\n  const removePackingItem = (id) => {\n    const items = carnivals[activeCarnivalId]?.packing || [];\n    updateCarnivalData('packing', items.filter(i => i.id !== id));\n  };\n\n  const addSquadMember = () => {\n    if (!newSquadMember.trim()) return;\n    const items = carnivals[activeCarnivalId]?.squad || [];\n    const newItem = { id: Date.now().toString(), name: newSquadMember.trim() };\n    updateCarnivalData('squad', [...items, newItem]);\n    setNewSquadMember('');\n  };\n  const removeSquadMember = (id) => {\n    const items = carnivals[activeCarnivalId]?.squad || [];\n    updateCarnivalData('squad', items.filter(i => i.id !== id));\n  };\n\n  // Squad Sharing Functions\n  const createSquadShareCode = async () => {\n    const carnival = activeCarnivalId ? carnivals[activeCarnivalId] : null;\n    if (!activeCarnivalId || !carnival) return;\n    setIsCreatingShare(true);\n    setSquadShareError('');\n    try {\n      const functions = getFunctions(app);\n      const createShare = httpsCallable(functions, 'createSquadShareCode');\n      const result = await createShare({ \n        carnivalId: activeCarnivalId, \n        carnivalName: carnival.name,\n        uid: user.uid\n      });\n      setSquadShareCode(result.data.shareCode);\n      // Save share code to user's carnival data for persistence\n      updateCarnivalData('shareCode', result.data.shareCode);\n      updateCarnivalData('sharedPlanId', result.data.planId);\n      setSquadShareSuccess('Share code created!');\n      setTimeout(() => setSquadShareSuccess(''), 3000);\n    } catch (err) {\n      console.error('Error creating share code:', err);\n      setSquadShareError(err.message || 'Failed to create share code');\n    } finally {\n      setIsCreatingShare(false);\n    }\n  };\n\n  // Load share code when carnival changes\n  useEffect(() => {\n    const carnival = activeCarnivalId ? carnivals[activeCarnivalId] : null;\n    if (carnival?.shareCode) {\n      setSquadShareCode(carnival.shareCode);\n    } else {\n      setSquadShareCode('');\n    }\n  }, [activeCarnivalId, carnivals]);\n\n  const joinSquadByCode = async () => {\n    if (!joinCode.trim() || joinCode.length !== 6) {\n      setSquadShareError('Please enter a valid 6-character code');\n      return;\n    }\n    setIsJoiningSquad(true);\n    setSquadShareError('');\n    try {\n      const functions = getFunctions(app);\n      const joinSquad = httpsCallable(functions, 'joinSquadByCode');\n      const result = await joinSquad({ \n        shareCode: joinCode.toUpperCase(),\n        uid: user.uid,\n        email: user.email\n      });\n      setSquadShareSuccess(`Joined ${result.data.carnivalName} squad!`);\n      setJoinCode('');\n      setTimeout(() => setSquadShareSuccess(''), 3000);\n    } catch (err) {\n      console.error('Error joining squad:', err);\n      setSquadShareError(err.message || 'Failed to join squad');\n    } finally {\n      setIsJoiningSquad(false);\n    }\n  };\n\n  const copyShareCode = () => {\n    if (squadShareCode) {\n      navigator.clipboard.writeText(squadShareCode);\n      setSquadShareSuccess('Code copied to clipboard!');\n      setTimeout(() => setSquadShareSuccess(''), 2000);\n    }\n  };\n\n  const saveCostume = () => {\n    updateCarnivalData('costume', {\n      ...costumeDetails,\n      total: parseFloat(costumeDetails.total) || 0,\n      paid: parseFloat(costumeDetails.paid) || 0,\n      updatedAt: Date.now()\n    });\n    alert('Costume details saved!');\n  };\n\n  const handleExport = () => {\n    if (!currentCarnival) return;\n    const lines = [];\n    lines.push(`CARNIVAL PLANNER: ${currentCarnival.name}`);\n    lines.push('==========================================\\n');\n    lines.push(`-- SQUAD --`);\n    (currentCarnival.squad || []).forEach(s => lines.push(`- ${s.name}`));\n    lines.push('\\n');\n    lines.push('-- COSTUME --');\n    if (currentCarnival.costume) {\n      lines.push(`Band: ${currentCarnival.costume.band}`);\n      lines.push(`Section: ${currentCarnival.costume.section}`);\n      lines.push(`Balance Due: $${((currentCarnival.costume.total || 0) - (currentCarnival.costume.paid || 0)).toFixed(2)}`);\n    } else {\n      lines.push('No costume details.');\n    }\n    lines.push('\\n');\n    lines.push('-- SCHEDULE --');\n    const sorted = (currentCarnival.schedule || []).slice().sort((a,b) => new Date(a.datetime) - new Date(b.datetime));\n    sorted.forEach(s => lines.push(`${new Date(s.datetime).toLocaleString()} | ${s.title}`));\n    \n    const blob = new Blob([lines.join('\\n')], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${currentCarnival.name.replace(/\\s+/g, '_')}_Plan.txt`;\n    a.click();\n  };\n\n\n  // --- RENDER VARS ---\n  const currentCarnival = activeCarnivalId ? carnivals[activeCarnivalId] : null;\n  const budgetTotal = currentCarnival?.budget?.reduce((acc, item) => acc + (item.cost || 0), 0) || 0;\n  const costumeBalance = currentCarnival?.costume ? (currentCarnival.costume.total - currentCarnival.costume.paid) : 0;\n  const curatedEvents = currentCarnival ? (POPULAR_EVENTS[activeCarnivalId] || POPULAR_EVENTS.default) : [];\n\n  // --- VIEW: LEGAL PAGES & CONTACT ---\n  if (activeLegalPage) {\n    const legalProps = { onBack: () => setActiveLegalPage(null), logo };\n    switch (activeLegalPage) {\n      case 'privacy': return <PrivacyPolicy {...legalProps} />;\n      case 'terms': return <TermsOfService {...legalProps} />;\n      case 'cookies': return <CookiePolicy {...legalProps} />;\n      case 'refund': return <RefundPolicy {...legalProps} />;\n      case 'contact': return <ContactPage {...legalProps} user={user} />;\n      default: setActiveLegalPage(null);\n    }\n  }\n\n  // --- VIEW: SPLASH SCREEN ---\n  if (showLanding && !user) {\n    return <SplashPage onGetStarted={() => setShowLanding(false)} logo={logo} onLegalPage={setActiveLegalPage} />;\n  }\n\n  // --- VIEW: ROAD MODE (PREMIUM) ---\n  if (user && roadMode && currentCarnival) {\n    const nextEvent = (currentCarnival.schedule || [])\n      .slice()\n      .sort((a, b) => new Date(a.datetime) - new Date(b.datetime))\n      .find(e => new Date(e.datetime) > new Date());\n\n    return (\n      <div className=\"min-h-screen bg-gray-900 text-white p-6 flex flex-col\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-2xl font-bold italic\">ROAD MODE</h1>\n          <button onClick={() => setRoadMode(false)} className=\"text-sm bg-gray-800 px-3 py-1 rounded\">Exit</button>\n        </div>\n        <div className=\"flex-1 flex flex-col gap-6\">\n          <div className=\"bg-gradient-to-r from-purple-600 to-blue-600 p-6 rounded-2xl shadow-lg\">\n            <h2 className=\"text-sm font-bold opacity-75 uppercase tracking-wider mb-1\">Up Next</h2>\n            {nextEvent ? (\n              <>\n                <div className=\"text-3xl font-black mb-1\">{nextEvent.title}</div>\n                <div className=\"text-xl opacity-90\">{new Date(nextEvent.datetime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>\n                <div className=\"mt-2 text-sm bg-white/20 inline-block px-2 py-1 rounded\">{nextEvent.note || \"No notes\"}</div>\n              </>\n            ) : (\n              <div className=\"text-xl italic opacity-75\">No more fetes scheduled! Sleep time?</div>\n            )}\n          </div>\n          <div className=\"bg-gray-800 p-6 rounded-2xl border border-gray-700\">\n            <h2 className=\"text-sm font-bold opacity-75 uppercase tracking-wider mb-2\">Costume Pickup</h2>\n            {currentCarnival.costume ? (\n              <div>\n                <div className=\"text-xl font-bold text-yellow-400\">{currentCarnival.costume.band}</div>\n                <div className=\"text-gray-400\">Section: {currentCarnival.costume.section}</div>\n                {costumeBalance > 0 && <div className=\"text-red-400 font-bold mt-1\">Balance Due: ${costumeBalance}</div>}\n              </div>\n            ) : (\n              <div className=\"text-gray-500 italic\">No costume details saved.</div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // --- VIEW: MAIN APP ---\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 transition-colors duration-200\">\n      {/* TOAST NOTIFICATION */}\n      {toastMessage && (\n        <div className=\"fixed top-4 right-4 z-50 animate-slideIn\">\n          <div className=\"bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-xl shadow-2xl max-w-sm\">\n            <div className=\"flex items-start gap-3\">\n              <span className=\"text-2xl\">üéâ</span>\n              <div>\n                <p className=\"font-bold\">{toastMessage.title}</p>\n                <p className=\"text-sm opacity-90\">{toastMessage.body}</p>\n              </div>\n              <button onClick={() => setToastMessage(null)} className=\"ml-2 text-white/70 hover:text-white\">√ó</button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* PWA INSTALL PROMPT */}\n      <InstallPrompt />\n      \n      {/* HEADER */}\n      <header className=\"bg-white dark:bg-gray-800 shadow-sm py-4 px-4 flex justify-between items-center sticky top-0 z-20 transition-colors\">\n        <div className=\"flex items-center gap-2\">\n          <img src={logo} alt=\"Logo\" className=\"w-8 h-8\" />\n          <h1 className=\"text-lg font-bold text-gray-800 dark:text-white hidden sm:block\">Carnival Planner</h1>\n        </div>\n        {user && (\n          <div className=\"flex items-center gap-3\">\n             {/* Dark Mode Toggle */}\n             <button onClick={() => setDarkMode(!darkMode)} className=\"p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-yellow-300\">\n               {darkMode ? '‚òÄÔ∏è' : 'üåô'}\n             </button>\n            {currentCarnival && (\n              <button \n                onClick={toggleRoadMode}\n                disabled={isSendingRoadReadyAlert}\n                className=\"px-3 py-1 text-xs font-bold rounded-full transition bg-purple-100 text-purple-700 hover:bg-purple-200 dark:bg-purple-900 dark:text-purple-200 disabled:opacity-50\"\n              >\n                {isSendingRoadReadyAlert ? '...' : 'GO ROAD READY'}\n              </button>\n            )}\n            {!isPremium ? (\n              <span className=\"text-xs text-gray-400 dark:text-gray-500\">Free Plan</span>\n            ) : (\n               <span className=\"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full font-bold\">Premium</span>\n            )}\n            <button onClick={handleSignOut} className=\"text-sm font-medium text-gray-500 hover:text-red-500 dark:text-gray-400\">Sign Out</button>\n          </div>\n        )}\n      </header>\n\n      {/* EMAIL VERIFICATION BANNER */}\n      {user && <EmailVerificationBanner user={user} />}\n\n      {/* BODY */}\n      <main className=\"flex-1 p-4 max-w-4xl mx-auto w-full\">\n        {!user ? (\n          <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\n            {showEmailAuth ? (\n              <EmailAuthForm \n                onBack={() => setShowEmailAuth(false)}\n                onSuccess={() => setShowEmailAuth(false)}\n              />\n            ) : (\n              <>\n                <h2 className=\"text-3xl font-bold mb-6 text-gray-800 dark:text-white\">Welcome Back</h2>\n                <div className=\"space-y-3 w-full max-w-sm\">\n                  <button \n                    onClick={handleSignIn} \n                    className=\"w-full flex items-center justify-center px-6 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-white transition-colors\"\n                  >\n                    <img src=\"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg\" className=\"w-5 h-5 mr-3\" alt=\"G\" />\n                    Continue with Google\n                  </button>\n                  <div className=\"flex items-center gap-3 text-gray-400 dark:text-gray-500\">\n                    <div className=\"flex-1 h-px bg-gray-300 dark:bg-gray-600\"></div>\n                    <span className=\"text-sm\">or</span>\n                    <div className=\"flex-1 h-px bg-gray-300 dark:bg-gray-600\"></div>\n                  </div>\n                  <button \n                    onClick={() => setShowEmailAuth(true)} \n                    className=\"w-full flex items-center justify-center px-6 py-3 bg-gradient-to-r from-pink-500 to-orange-500 rounded-lg shadow-sm hover:opacity-90 text-white font-semibold transition-opacity\"\n                  >\n                    Continue with Email\n                  </button>\n                </div>\n                <button \n                  onClick={() => setShowLanding(true)} \n                  className=\"mt-6 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300\"\n                >\n                  Back to home\n                </button>\n              </>\n            )}\n          </div>\n        ) : (\n          <div>\n            {/* CARNIVAL SELECTOR */}\n            <div className=\"mb-8\">\n              <div className=\"flex gap-4 overflow-x-auto pb-4 snap-x\">\n                {carnivalOptions.map((c, idx) => {\n                  const isActive = activeCarnivalId === c.id;\n                  const gradient = gradientClasses[idx % gradientClasses.length];\n                  const carnivalNameMap = {\n                    'stkitts-sugar-mas': 'Sugar Mas',\n                    'stmaarten': 'Maarten',\n                    'stlucia': 'Lucia',\n                    'trinidad': 'Trinidad Carnival',\n                    'jamaica': 'Jamaica Carnival',\n                    'barbados': 'Crop Over',\n                    'antigua': 'Antigua Carnival',\n                    'grenada': 'Spice Mas',\n                    'usvi': 'St. Thomas Carnival',\n                    'bahamas': 'Bahamas Carnival',\n                    'miami': 'Miami Carnival',\n                    'nottinghill': 'Notting Hill Carnival',\n                    'toronto': 'Toronto Caribbean Carnival',\n                    'atlanta': 'Atlanta Caribbean Carnival',\n                    'ny-labor-day': 'New York Carnival',\n                    'bermuda': 'Bermuda Carnival',\n                    'vincymas': 'Vincy Mas',\n                    'aruba': 'Aruba Carnival',\n                    'guyana-mashramani': 'Guyana Mashramani',\n                    'guyana-independence': 'Guyana Independence',\n                    'tobago': 'Tobago Carnival'\n                  };\n                  const searchName = carnivalNameMap[c.id] || c.name;\n                  const matchingCarnival = carnivalData.find(cd => \n                    cd.name.toLowerCase().includes(searchName.toLowerCase()) ||\n                    searchName.toLowerCase().includes(cd.name.split('(')[0].trim().toLowerCase())\n                  );\n                  let daysUntil = null;\n                  if (matchingCarnival) {\n                    const now = new Date();\n                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n                    const [year, month, day] = matchingCarnival.date.split('-').map(Number);\n                    const carnivalDate = new Date(year, month - 1, day);\n                    if (carnivalDate >= today) {\n                      daysUntil = Math.round((carnivalDate - today) / (1000 * 60 * 60 * 24));\n                    }\n                  }\n                  return (\n                    <div\n                      key={c.id}\n                      onClick={() => selectCarnival(c.id, `${c.name} - ${monthNames[c.monthIndex]}`)}\n                      className={`snap-center min-w-[200px] cursor-pointer rounded-2xl p-5 shadow-lg relative overflow-hidden transition-all duration-300 ${isActive ? 'ring-4 ring-offset-2 ring-blue-400 scale-105' : 'hover:scale-105 opacity-90'} ${gradient}`}\n                    >\n                      <div className=\"relative z-10 text-white\">\n                        <h4 className=\"font-bold text-lg leading-tight mb-1\">{c.name}</h4>\n                        <p className=\"text-xs font-medium uppercase tracking-wider opacity-90\">{monthNames[c.monthIndex]}</p>\n                        {daysUntil !== null && (\n                          <div className=\"mt-2 bg-white/20 backdrop-blur-sm rounded-lg px-2 py-1 inline-block\">\n                            <span className=\"text-lg font-black\">{daysUntil}</span>\n                            <span className=\"text-xs ml-1 opacity-90\">days</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* DASHBOARD */}\n            {!currentCarnival ? (\n              <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-dashed border-gray-300 dark:border-gray-600\">\n                <p className=\"text-gray-500 dark:text-gray-400\">Select a carnival above to begin.</p>\n              </div>\n            ) : (\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden transition-colors\">\n                {/* PREMIUM UPGRADE BANNER - Only shown to free users */}\n                {!isPremium && (\n                  <div className=\"bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 p-4 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <span className=\"text-2xl\">‚ú®</span>\n                      <div>\n                        <p className=\"text-white font-bold text-sm\">Unlock Premium Features</p>\n                        <p className=\"text-white/80 text-xs\">Go ad-free and get a Premium badge!</p>\n                      </div>\n                    </div>\n                    <button \n                      onClick={() => setActiveTab('Info')}\n                      className=\"px-4 py-2 bg-white text-orange-600 font-bold text-sm rounded-full hover:bg-gray-100 transition\"\n                    >\n                      Upgrade\n                    </button>\n                  </div>\n                )}\n                {/* PROMO ADS - Only shown to free users */}\n                {!isPremium && (\n                  <div className=\"border-b border-gray-100 dark:border-gray-700\">\n                    <PromoAd placement=\"banner\" />\n                  </div>\n                )}\n                {/* TABS */}\n                <div className=\"flex border-b border-gray-100 dark:border-gray-700 overflow-x-auto scrollbar-hide\">\n                  {['Budget', 'Costume', 'Schedule', 'Squad', 'Packing', ...(isPremium ? ['Map', 'Media'] : []), 'Info'].map((tab) => (\n                    <button\n                      key={tab}\n                      onClick={() => setActiveTab(tab)}\n                      className={`flex-shrink-0 px-3 sm:px-4 py-3 sm:py-4 text-xs sm:text-sm font-medium transition-colors relative whitespace-nowrap ${activeTab === tab ? 'text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/20' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200'}`}\n                    >\n                      {tab}\n                      {(tab === 'Map' || tab === 'Media') && <span className=\"ml-1 text-xs text-yellow-500\">‚òÖ</span>}\n                      {activeTab === tab && <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 dark:bg-blue-400\"></div>}\n                    </button>\n                  ))}\n                </div>\n\n                <div className=\"p-6\">\n                  {/* TAB: BUDGET (Free) */}\n                  {activeTab === 'Budget' && (\n                    <div className=\"animate-fadeIn\">\n                      <div className=\"flex justify-between items-end mb-6\">\n                        <h3 className=\"text-xl font-bold text-gray-800 dark:text-white\">Budget</h3>\n                        <div className=\"text-right\">\n                          <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Estimate</p>\n                          <p className=\"text-2xl font-black text-green-600 dark:text-green-400\">${budgetTotal.toFixed(2)}</p>\n                        </div>\n                      </div>\n                      <div className=\"space-y-3 mb-6\">\n                        {(currentCarnival.budget || []).map((item) => (\n                          <div key={item.id} className=\"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg group hover:bg-gray-100 dark:hover:bg-gray-600\">\n                            <span className=\"font-medium text-gray-700 dark:text-gray-200\">{item.name}</span>\n                            <div className=\"flex items-center gap-4\">\n                              <span className=\"font-bold text-gray-900 dark:text-white\">${item.cost.toFixed(2)}</span>\n                              <button onClick={() => removeBudgetItem(item.id)} className=\"text-gray-400 hover:text-red-500\">√ó</button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                      <div className=\"flex flex-col sm:flex-row gap-2\">\n                        <div className=\"flex gap-2 flex-1\">\n                          <input type=\"text\" placeholder=\"Item\" value={newBudgetName} onChange={(e) => setNewBudgetName(e.target.value)} className=\"flex-[2] p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm\" />\n                          <input type=\"number\" placeholder=\"0.00\" value={newBudgetCost} onChange={(e) => setNewBudgetCost(e.target.value)} className=\"flex-1 p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm\" />\n                        </div>\n                        <button onClick={addBudgetItem} className=\"w-full sm:w-auto px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium\">Add</button>\n                      </div>\n                      {/* Inline Ad for free users */}\n                      {!isPremium && (\n                        <div className=\"mt-6 pt-4 border-t border-gray-100 dark:border-gray-700\">\n                          <PromoAd placement=\"inline\" />\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* TAB: COSTUME (Free) */}\n                  {activeTab === 'Costume' && (\n                    <div className=\"animate-fadeIn\">\n                      <h3 className=\"text-xl font-bold text-gray-800 dark:text-white mb-4\">Mas Costume</h3>\n                      <div className=\"bg-pink-50 dark:bg-pink-900/20 p-6 rounded-xl border border-pink-100 dark:border-pink-900 mb-4\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <div>\n                            <label className=\"block text-xs font-bold text-pink-800 dark:text-pink-300 uppercase mb-1\">Band Name</label>\n                            <input \n                              type=\"text\" \n                              className=\"w-full p-2 border border-pink-200 dark:border-pink-800 rounded dark:bg-gray-700 dark:text-white\" \n                              value={costumeDetails.band || (currentCarnival.costume?.band || '')}\n                              onChange={(e) => setCostumeDetails({...costumeDetails, band: e.target.value})}\n                              placeholder=\"e.g. Tribe, Bliss...\"\n                            />\n                          </div>\n                          <div>\n                            <label className=\"block text-xs font-bold text-pink-800 dark:text-pink-300 uppercase mb-1\">Section</label>\n                            <input \n                              type=\"text\" \n                              className=\"w-full p-2 border border-pink-200 dark:border-pink-800 rounded dark:bg-gray-700 dark:text-white\" \n                              value={costumeDetails.section || (currentCarnival.costume?.section || '')}\n                              onChange={(e) => setCostumeDetails({...costumeDetails, section: e.target.value})}\n                              placeholder=\"e.g. The Monarch\"\n                            />\n                          </div>\n                          <div>\n                            <label className=\"block text-xs font-bold text-pink-800 dark:text-pink-300 uppercase mb-1\">Total Cost</label>\n                            <input \n                              type=\"number\" \n                              className=\"w-full p-2 border border-pink-200 dark:border-pink-800 rounded dark:bg-gray-700 dark:text-white\" \n                              value={costumeDetails.total || (currentCarnival.costume?.total || '')}\n                              onChange={(e) => setCostumeDetails({...costumeDetails, total: e.target.value})}\n                              placeholder=\"0.00\"\n                            />\n                          </div>\n                          <div>\n                            <label className=\"block text-xs font-bold text-pink-800 dark:text-pink-300 uppercase mb-1\">Amount Paid</label>\n                            <input \n                              type=\"number\" \n                              className=\"w-full p-2 border border-pink-200 dark:border-pink-800 rounded dark:bg-gray-700 dark:text-white\" \n                              value={costumeDetails.paid || (currentCarnival.costume?.paid || '')}\n                              onChange={(e) => setCostumeDetails({...costumeDetails, paid: e.target.value})}\n                              placeholder=\"0.00\"\n                            />\n                          </div>\n                        </div>\n                        <button onClick={saveCostume} className=\"mt-4 w-full py-2 bg-pink-600 text-white font-bold rounded hover:bg-pink-700\">\n                          Save Details\n                        </button>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* TAB: SCHEDULE (Free) */}\n                  {activeTab === 'Schedule' && (\n                    <div className=\"animate-fadeIn\">\n                       <h3 className=\"text-xl font-bold text-gray-800 dark:text-white mb-4\">Itinerary</h3>\n                       \n                       {/* Popular Events - Free for all users */}\n                       {curatedEvents.length > 0 && (\n                         <div className=\"mb-6\">\n                           <p className=\"text-xs font-bold text-gray-400 uppercase mb-2\">Popular Events (Click to Add)</p>\n                           <div className=\"flex gap-2 overflow-x-auto pb-2\">\n                             {curatedEvents.map((evt, i) => (\n                               <button \n                                 key={i} \n                                 onClick={() => addCuratedEvent(evt)}\n                                 className=\"min-w-[140px] p-3 text-left rounded-lg border transition bg-blue-50 dark:bg-blue-900/30 border-blue-100 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-800\"\n                               >\n                                 <div className=\"font-bold text-blue-900 dark:text-blue-300 text-sm\">{evt.title}</div>\n                                 <div className=\"text-xs text-blue-700 dark:text-blue-400 opacity-75 truncate\">{evt.note}</div>\n                               </button>\n                             ))}\n                           </div>\n                         </div>\n                       )}\n\n                       <div className=\"space-y-4 mb-6\">\n                        {(currentCarnival.schedule || []).map((event) => (\n                              <div key={event.id} className=\"flex gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border-l-4 border-blue-400 relative group\">\n                                <div className=\"text-center min-w-[60px]\">\n                                  <span className=\"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase\">{new Date(event.datetime).toLocaleDateString(undefined, {month:'short'})}</span>\n                                  <span className=\"block text-xl font-black text-gray-800 dark:text-white\">{new Date(event.datetime).getDate()}</span>\n                                  <span className=\"block text-xs text-gray-500 dark:text-gray-400\">{new Date(event.datetime).toLocaleTimeString(undefined, {hour:'numeric', minute:'2-digit'})}</span>\n                                </div>\n                                <div>\n                                  <h4 className=\"font-bold text-gray-800 dark:text-white\">{event.title}</h4>\n                                  {event.note && <p className=\"text-sm text-gray-600 dark:text-gray-300 mt-1\">{event.note}</p>}\n                                </div>\n                                <button onClick={() => removeScheduleItem(event.id)} className=\"absolute top-2 right-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100\">√ó</button>\n                              </div>\n                            ))}\n                       </div>\n                       <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 bg-gray-50 dark:bg-gray-700 p-4 rounded-xl\">\n                          <input type=\"text\" placeholder=\"Event Name\" value={newScheduleName} onChange={(e) => setNewScheduleName(e.target.value)} className=\"p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white\" />\n                          <input type=\"datetime-local\" value={newScheduleDate} onChange={(e) => setNewScheduleDate(e.target.value)} className=\"p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white\" />\n                          <input type=\"text\" placeholder=\"Notes\" value={newScheduleNote} onChange={(e) => setNewScheduleNote(e.target.value)} className=\"p-2 border rounded md:col-span-2 dark:bg-gray-800 dark:border-gray-600 dark:text-white\" />\n                          <button onClick={addScheduleItem} className=\"md:col-span-2 py-2 bg-blue-600 text-white rounded font-medium hover:bg-blue-700\">Add Event</button>\n                       </div>\n                    </div>\n                  )}\n\n                  {/* TAB: SQUAD (Free) */}\n                  {activeTab === 'Squad' && (\n                    <div className=\"animate-fadeIn\">\n                      <div className=\"flex justify-between items-center mb-4\">\n                        <h3 className=\"text-xl font-bold text-gray-800 dark:text-white\">Your Squad</h3>\n                        <span className=\"text-sm bg-purple-100 text-purple-800 px-2 py-1 rounded-full\">{currentCarnival.squad?.length || 0} members</span>\n                      </div>\n\n                      {/* Squad Sharing Section */}\n                      <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border border-purple-200 dark:border-purple-800 rounded-xl p-4 mb-4\">\n                        <h4 className=\"font-bold text-purple-800 dark:text-purple-300 mb-3 flex items-center gap-2\">\n                          <span>üîó</span> Squad Sharing\n                        </h4>\n                        \n                        {/* Status Messages */}\n                        {squadShareError && (\n                          <div className=\"mb-3 p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-sm\">\n                            {squadShareError}\n                          </div>\n                        )}\n                        {squadShareSuccess && (\n                          <div className=\"mb-3 p-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-sm\">\n                            {squadShareSuccess}\n                          </div>\n                        )}\n\n                        <div className=\"grid md:grid-cols-2 gap-4\">\n                          {/* Create Share Code */}\n                          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-3\">\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Share your carnival plan with friends:</p>\n                            {squadShareCode ? (\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-2xl font-mono font-bold text-purple-600 dark:text-purple-400 tracking-wider\">{squadShareCode}</span>\n                                <button \n                                  onClick={copyShareCode}\n                                  className=\"text-sm bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 px-3 py-1 rounded hover:bg-purple-200\"\n                                >\n                                  Copy\n                                </button>\n                              </div>\n                            ) : (\n                              <button \n                                onClick={createSquadShareCode}\n                                disabled={isCreatingShare}\n                                className=\"w-full py-2 bg-purple-600 text-white rounded font-medium hover:bg-purple-700 disabled:opacity-50\"\n                              >\n                                {isCreatingShare ? 'Creating...' : 'Generate Share Code'}\n                              </button>\n                            )}\n                          </div>\n\n                          {/* Join Squad */}\n                          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-3\">\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Join a friend's squad:</p>\n                            <div className=\"flex gap-2\">\n                              <input \n                                type=\"text\" \n                                placeholder=\"Enter 6-digit code\"\n                                value={joinCode}\n                                onChange={(e) => setJoinCode(e.target.value.toUpperCase().slice(0, 6))}\n                                className=\"flex-1 p-2 border rounded font-mono text-center tracking-wider uppercase dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                                maxLength={6}\n                              />\n                              <button \n                                onClick={joinSquadByCode}\n                                disabled={isJoiningSquad || joinCode.length !== 6}\n                                className=\"bg-pink-600 text-white px-4 rounded hover:bg-pink-700 disabled:opacity-50\"\n                              >\n                                {isJoiningSquad ? '...' : 'Join'}\n                              </button>\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {/* Premium: Road Ready Notification Toggle */}\n                        {isPremium && (\n                          <div className=\"mt-4 pt-4 border-t border-purple-200 dark:border-purple-700\">\n                            <label className=\"flex items-center gap-3 cursor-pointer\">\n                              <input \n                                type=\"checkbox\" \n                                checked={notifySquadOnRoadReady}\n                                onChange={(e) => setNotifySquadOnRoadReady(e.target.checked)}\n                                className=\"w-5 h-5 text-purple-600 rounded\"\n                              />\n                              <div>\n                                <span className=\"font-medium text-purple-800 dark:text-purple-300\">Notify squad when I go Road Ready</span>\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Send push notification to squad members</p>\n                              </div>\n                              <span className=\"ml-auto text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full\">Premium</span>\n                            </label>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Manual Squad List */}\n                      <div className=\"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 mb-4\">\n                        <h4 className=\"font-medium text-gray-700 dark:text-gray-300 mb-3\">Squad Members</h4>\n                        <div className=\"flex flex-col sm:flex-row gap-2 mb-4\">\n                          <input \n                            type=\"text\" \n                            placeholder=\"Add friend's name\" \n                            value={newSquadMember}\n                            onChange={(e) => setNewSquadMember(e.target.value)}\n                            className=\"flex-1 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm\"\n                          />\n                          <button onClick={addSquadMember} className=\"w-full sm:w-auto bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 font-medium\">Add</button>\n                        </div>\n                        <div className=\"flex flex-wrap gap-2\">\n                           {(currentCarnival.squad || []).map(member => (\n                             <div key={member.id} className=\"flex items-center gap-2 bg-purple-50 dark:bg-purple-900/30 px-3 py-1 rounded-full border border-purple-100 dark:border-purple-800\">\n                               <span className=\"text-purple-900 dark:text-purple-200 font-medium\">{member.name}</span>\n                               <button onClick={() => removeSquadMember(member.id)} className=\"text-purple-400 hover:text-red-500 text-xs font-bold\">√ó</button>\n                             </div>\n                           ))}\n                           {(currentCarnival.squad || []).length === 0 && <p className=\"text-gray-400 italic text-sm\">No squad members added yet. Riding solo?</p>}\n                        </div>\n                      </div>\n                      {/* Inline Ad for free users */}\n                      {!isPremium && (\n                        <div className=\"mt-4\">\n                          <PromoAd placement=\"inline\" />\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* TAB: PACKING (Free) */}\n                  {activeTab === 'Packing' && (\n                    <div className=\"animate-fadeIn\">\n                      <h3 className=\"text-xl font-bold text-gray-800 dark:text-white mb-4\">Packing List</h3>\n                      <div className=\"space-y-2 mb-6\">\n                        {(currentCarnival.packing || []).map((item) => (\n                          <div key={item.id} className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-700 border border-gray-100 dark:border-gray-600 shadow-sm rounded-lg\">\n                            <div className=\"flex items-center gap-3\">\n                              <input type=\"checkbox\" checked={item.checked} onChange={() => togglePackingItem(item.id)} className=\"w-5 h-5 text-blue-600 rounded\" />\n                              <span className={`text-gray-700 dark:text-gray-200 ${item.checked ? 'line-through opacity-50' : ''}`}>{item.item}</span>\n                            </div>\n                            <button onClick={() => removePackingItem(item.id)} className=\"text-gray-400 hover:text-red-500\">√ó</button>\n                          </div>\n                        ))}\n                      </div>\n                      <div className=\"flex flex-col sm:flex-row gap-2\">\n                        <input type=\"text\" placeholder=\"Item\" value={newPackingItem} onChange={(e) => setNewPackingItem(e.target.value)} className=\"flex-1 p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm\" />\n                        <button onClick={addPackingItem} className=\"w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium\">Add</button>\n                      </div>\n                      {/* Inline Ad for free users */}\n                      {!isPremium && (\n                        <div className=\"mt-6 pt-4 border-t border-gray-100 dark:border-gray-700\">\n                          <PromoAd placement=\"inline\" />\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* TAB: MAP (Premium) */}\n                  {activeTab === 'Map' && isPremium && (\n                    <div className=\"animate-fadeIn\">\n                      <FeteMap\n                        locations={currentCarnival.mapLocations || []}\n                        onLocationsChange={(newLocations) => updateCarnivalData('mapLocations', newLocations)}\n                        carnivalName={currentCarnival.name}\n                        carnivalId={activeCarnivalId}\n                      />\n                    </div>\n                  )}\n\n                  {/* TAB: MEDIA VAULT (Premium) */}\n                  {activeTab === 'Media' && isPremium && (\n                    <div className=\"animate-fadeIn\">\n                      <MediaVault\n                        files={currentCarnival.mediaFiles || []}\n                        onFilesChange={(newFiles) => updateCarnivalData('mediaFiles', newFiles)}\n                        carnivalName={currentCarnival.name}\n                        carnivalId={activeCarnivalId}\n                        userId={user.uid}\n                      />\n                    </div>\n                  )}\n\n                  {/* TAB: INFO & EXPORT */}\n                  {activeTab === 'Info' && (\n                    <div className=\"animate-fadeIn text-center\">\n                      <div className=\"bg-gradient-to-br from-gray-900 to-gray-800 text-white rounded-2xl p-8 mb-6 shadow-xl\">\n                         <img src={logo} alt=\"Logo\" className=\"w-20 h-20 mx-auto mb-4\" />\n                         <h2 className=\"text-2xl font-bold mb-2\">{isPremium ? \"Premium Supporter\" : \"Support the App\"}</h2>\n                         <p className=\"text-gray-400 mb-6\">{isPremium ? \"Thank you for supporting Carnival Planner!\" : \"All features are free! Premium removes ads and shows your support.\"}</p>\n                         \n                         <button \n                           onClick={handleExport} \n                           className=\"flex items-center justify-center gap-2 mx-auto px-6 py-3 rounded-full font-bold transition-colors bg-white text-gray-900 hover:bg-gray-100\"\n                         >\n                           <span>üì•</span> Export Itinerary\n                         </button>\n                      </div>\n                      \n                      {/* Premium Subscription Buttons (Upsell) */}\n                      {!isPremium && (\n                         <div className=\"bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6\">\n                           <h3 className=\"font-bold text-yellow-800 dark:text-yellow-400 mb-2\">Become a Premium Supporter</h3>\n                           <p className=\"text-yellow-700 dark:text-yellow-500 text-sm mb-4\">Get an ad-free experience and a Premium badge to show your support!</p>\n                           <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                              <button \n                                onClick={() => handleSubscribe(\"monthly\")} \n                                disabled={isCheckingOut}\n                                className=\"px-4 py-2 bg-blue-600 text-white font-bold rounded shadow hover:bg-blue-700 disabled:opacity-50\"\n                              >\n                                {isCheckingOut ? \"Loading...\" : \"Monthly - $4.99\"}\n                              </button>\n                              <button \n                                onClick={() => handleSubscribe(\"yearly\")} \n                                disabled={isCheckingOut}\n                                className=\"px-4 py-2 bg-yellow-400 text-yellow-900 font-bold rounded shadow hover:bg-yellow-500 disabled:opacity-50\"\n                              >\n                                {isCheckingOut ? \"Loading...\" : \"Yearly - $39.99\"}\n                              </button>\n                           </div>\n                         </div>\n                      )}\n\n                      {/* Account Settings */}\n                      <div className=\"mt-6\">\n                        <AccountSettings user={user} />\n                      </div>\n\n                      {/* AD MANAGER & SUPPORT - Admin Only */}\n                      {user?.email === 'djkrss1@gmail.com' && (\n                        <div className=\"mt-6 text-left\">\n                          <AdManager />\n                          <SupportAdmin />\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </main>\n\n      {/* Footer with Legal Links */}\n      <footer className=\"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-6 px-4 mt-auto\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <div className=\"flex flex-wrap justify-center gap-3 text-sm text-gray-500 dark:text-gray-400\">\n            <button \n              onClick={() => setActiveLegalPage('privacy')} \n              className=\"hover:text-gray-900 dark:hover:text-white transition-colors\"\n            >\n              Privacy\n            </button>\n            <span>|</span>\n            <button \n              onClick={() => setActiveLegalPage('terms')} \n              className=\"hover:text-gray-900 dark:hover:text-white transition-colors\"\n            >\n              Terms\n            </button>\n            <span>|</span>\n            <button \n              onClick={() => setActiveLegalPage('cookies')} \n              className=\"hover:text-gray-900 dark:hover:text-white transition-colors\"\n            >\n              Cookies\n            </button>\n            <span>|</span>\n            <button \n              onClick={() => setActiveLegalPage('refund')} \n              className=\"hover:text-gray-900 dark:hover:text-white transition-colors\"\n            >\n              Refunds\n            </button>\n            <span>|</span>\n            <button \n              onClick={() => setActiveLegalPage('contact')} \n              className=\"hover:text-gray-900 dark:hover:text-white transition-colors\"\n            >\n              Contact\n            </button>\n          </div>\n          <p className=\"text-gray-400 dark:text-gray-500 text-xs mt-3\">\n            ¬© {new Date().getFullYear()} Carnival Planner\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}","path":null,"size_bytes":61513,"size_tokens":null},"src/components/FeteMap.jsx":{"content":"import { useState, useEffect, useMemo } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { MapPin, Home, Shirt, PartyPopper, Users, Plus, Trash2, Navigation } from 'lucide-react';\n\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n});\n\nconst createColoredIcon = (color) => {\n  return L.divIcon({\n    className: 'custom-marker',\n    html: `<div style=\"background-color: ${color}; width: 24px; height: 24px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);\"></div>`,\n    iconSize: [24, 24],\n    iconAnchor: [12, 24],\n    popupAnchor: [0, -24],\n  });\n};\n\nconst PIN_TYPES = {\n  accommodation: { label: 'Accommodation', color: '#3B82F6', icon: Home },\n  costume: { label: 'Costume Pickup', color: '#F59E0B', icon: Shirt },\n  fete: { label: 'Fete Location', color: '#EC4899', icon: PartyPopper },\n  meetup: { label: 'Meetup Spot', color: '#10B981', icon: Users },\n};\n\nfunction MapUpdater({ center }) {\n  const map = useMap();\n  useEffect(() => {\n    if (center) {\n      map.setView(center, 13);\n    }\n  }, [center, map]);\n  return null;\n}\n\nfunction calculateDistance(lat1, lon1, lat2, lon2) {\n  const R = 6371;\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n    Math.sin(dLon/2) * Math.sin(dLon/2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n  return R * c;\n}\n\n// Country-specific map centers for each carnival\nconst CARNIVAL_CENTERS = {\n  'trinidad': { center: [10.6918, -61.2225], zoom: 11, country: 'Trinidad & Tobago' },\n  'stkitts-sugar-mas': { center: [17.3026, -62.7177], zoom: 12, country: 'St. Kitts' },\n  'aruba': { center: [12.5211, -69.9683], zoom: 12, country: 'Aruba' },\n  'guyana-mashramani': { center: [6.8013, -58.1551], zoom: 12, country: 'Guyana' },\n  'guyana-independence': { center: [6.8013, -58.1551], zoom: 12, country: 'Guyana' },\n  'jamaica': { center: [18.0179, -76.8099], zoom: 11, country: 'Jamaica' },\n  'stmaarten': { center: [18.0425, -63.0548], zoom: 12, country: 'St. Maarten' },\n  'bahamas': { center: [25.0343, -77.3963], zoom: 12, country: 'Bahamas' },\n  'bermuda': { center: [32.3078, -64.7505], zoom: 13, country: 'Bermuda' },\n  'vincymas': { center: [13.1587, -61.2248], zoom: 12, country: 'St. Vincent' },\n  'antigua': { center: [17.1274, -61.8468], zoom: 12, country: 'Antigua' },\n  'stlucia': { center: [14.0101, -60.9870], zoom: 11, country: 'St. Lucia' },\n  'tobago': { center: [11.1889, -60.7320], zoom: 11, country: 'Tobago' },\n  'nottinghill': { center: [51.5156, -0.2050], zoom: 14, country: 'London, UK' },\n  'miami': { center: [25.7617, -80.1918], zoom: 11, country: 'Miami, FL' },\n};\n\nexport default function FeteMap({ locations = [], onLocationsChange, carnivalName, carnivalId }) {\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [newPin, setNewPin] = useState({ name: '', type: 'fete', lat: '', lng: '' });\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [isSearching, setIsSearching] = useState(false);\n\n  const accommodation = locations.find(loc => loc.type === 'accommodation');\n  \n  // Get country-specific center or fall back to Trinidad\n  const carnivalConfig = CARNIVAL_CENTERS[carnivalId] || CARNIVAL_CENTERS['trinidad'];\n  \n  const defaultCenter = useMemo(() => {\n    if (accommodation) return [accommodation.lat, accommodation.lng];\n    if (locations.length > 0) return [locations[0].lat, locations[0].lng];\n    return carnivalConfig.center;\n  }, [locations, accommodation, carnivalConfig]);\n\n  const searchLocation = async () => {\n    if (!searchQuery.trim()) return;\n    setIsSearching(true);\n    try {\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}`\n      );\n      const data = await response.json();\n      setSearchResults(data.slice(0, 5));\n    } catch (error) {\n      console.error('Search error:', error);\n    }\n    setIsSearching(false);\n  };\n\n  const selectSearchResult = (result) => {\n    setNewPin({\n      ...newPin,\n      lat: parseFloat(result.lat),\n      lng: parseFloat(result.lon),\n      name: newPin.name || result.display_name.split(',')[0]\n    });\n    setSearchResults([]);\n    setSearchQuery('');\n  };\n\n  const addLocation = () => {\n    if (!newPin.name || !newPin.lat || !newPin.lng) return;\n    const newLocation = {\n      id: Date.now().toString(),\n      name: newPin.name,\n      type: newPin.type,\n      lat: parseFloat(newPin.lat),\n      lng: parseFloat(newPin.lng),\n    };\n    onLocationsChange([...locations, newLocation]);\n    setNewPin({ name: '', type: 'fete', lat: '', lng: '' });\n    setShowAddForm(false);\n  };\n\n  const removeLocation = (id) => {\n    onLocationsChange(locations.filter(loc => loc.id !== id));\n  };\n\n  const getDistanceFromAccommodation = (loc) => {\n    if (!accommodation || loc.type === 'accommodation') return null;\n    const dist = calculateDistance(accommodation.lat, accommodation.lng, loc.lat, loc.lng);\n    if (dist < 1) return `${Math.round(dist * 1000)}m`;\n    return `${dist.toFixed(1)}km`;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-bold text-gray-800 dark:text-white flex items-center gap-2\">\n            <MapPin className=\"w-5 h-5 text-purple-500\" />\n            Fete Map - {carnivalName}\n          </h3>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 ml-7\">\n            üìç {carnivalConfig.country}\n          </p>\n        </div>\n        <button\n          onClick={() => setShowAddForm(!showAddForm)}\n          className=\"flex items-center gap-1 px-3 py-1.5 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700 transition\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          Add Pin\n        </button>\n      </div>\n\n      {showAddForm && (\n        <div className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-3\">\n          <div className=\"grid grid-cols-2 gap-3\">\n            <input\n              type=\"text\"\n              placeholder=\"Location name\"\n              value={newPin.name}\n              onChange={(e) => setNewPin({ ...newPin, name: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white\"\n            />\n            <select\n              value={newPin.type}\n              onChange={(e) => setNewPin({ ...newPin, type: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white\"\n            >\n              {Object.entries(PIN_TYPES).map(([key, { label }]) => (\n                <option key={key} value={key}>{label}</option>\n              ))}\n            </select>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <input\n              type=\"text\"\n              placeholder=\"Search for a place...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              onKeyPress={(e) => e.key === 'Enter' && searchLocation()}\n              className=\"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white\"\n            />\n            <button\n              onClick={searchLocation}\n              disabled={isSearching}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {isSearching ? '...' : 'Search'}\n            </button>\n          </div>\n\n          {searchResults.length > 0 && (\n            <ul className=\"bg-white dark:bg-gray-600 border dark:border-gray-500 rounded-lg max-h-40 overflow-y-auto\">\n              {searchResults.map((result, idx) => (\n                <li\n                  key={idx}\n                  onClick={() => selectSearchResult(result)}\n                  className=\"px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-500 cursor-pointer text-sm truncate dark:text-white\"\n                >\n                  {result.display_name}\n                </li>\n              ))}\n            </ul>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-3\">\n            <input\n              type=\"number\"\n              step=\"any\"\n              placeholder=\"Latitude\"\n              value={newPin.lat}\n              onChange={(e) => setNewPin({ ...newPin, lat: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white\"\n            />\n            <input\n              type=\"number\"\n              step=\"any\"\n              placeholder=\"Longitude\"\n              value={newPin.lng}\n              onChange={(e) => setNewPin({ ...newPin, lng: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white\"\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={addLocation}\n              disabled={!newPin.name || !newPin.lat || !newPin.lng}\n              className=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Add Location\n            </button>\n            <button\n              onClick={() => setShowAddForm(false)}\n              className=\"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-white rounded-lg hover:bg-gray-400\"\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      <div className=\"h-[400px] rounded-xl overflow-hidden border-2 border-gray-200 dark:border-gray-600\">\n        <MapContainer\n          center={defaultCenter}\n          zoom={carnivalConfig.zoom}\n          style={{ height: '100%', width: '100%' }}\n        >\n          <TileLayer\n            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n          />\n          <MapUpdater center={defaultCenter} />\n          {locations.map((loc) => (\n            <Marker\n              key={loc.id}\n              position={[loc.lat, loc.lng]}\n              icon={createColoredIcon(PIN_TYPES[loc.type]?.color || '#6B7280')}\n            >\n              <Popup>\n                <div className=\"font-medium\">{loc.name}</div>\n                <div className=\"text-xs text-gray-500\">{PIN_TYPES[loc.type]?.label}</div>\n                {getDistanceFromAccommodation(loc) && (\n                  <div className=\"text-xs text-blue-600 flex items-center gap-1 mt-1\">\n                    <Navigation className=\"w-3 h-3\" />\n                    {getDistanceFromAccommodation(loc)} from accommodation\n                  </div>\n                )}\n              </Popup>\n            </Marker>\n          ))}\n        </MapContainer>\n      </div>\n\n      {locations.length > 0 && (\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-semibold text-gray-600 dark:text-gray-300\">Saved Locations</h4>\n          <div className=\"grid gap-2\">\n            {locations.map((loc) => {\n              const pinType = PIN_TYPES[loc.type];\n              const IconComponent = pinType?.icon || MapPin;\n              const distance = getDistanceFromAccommodation(loc);\n              return (\n                <div\n                  key={loc.id}\n                  className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div\n                      className=\"w-8 h-8 rounded-full flex items-center justify-center\"\n                      style={{ backgroundColor: pinType?.color || '#6B7280' }}\n                    >\n                      <IconComponent className=\"w-4 h-4 text-white\" />\n                    </div>\n                    <div>\n                      <div className=\"font-medium text-gray-800 dark:text-white\">{loc.name}</div>\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        {pinType?.label}\n                        {distance && ` ‚Ä¢ ${distance} from stay`}\n                      </div>\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => removeLocation(loc.id)}\n                    className=\"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {!accommodation && locations.length === 0 && (\n        <div className=\"text-center py-6 text-gray-500 dark:text-gray-400\">\n          <Home className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n          <p>Start by adding your accommodation location</p>\n          <p className=\"text-sm\">Then add fetes, costume pickup, and meetup spots</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":13603,"size_tokens":null},"src/components/PromoAd.jsx":{"content":"import { useState, useEffect } from 'react';\nimport { collection, query, where, onSnapshot } from 'firebase/firestore';\nimport { db } from '../firebase';\nimport { X } from 'lucide-react';\n\nexport default function PromoAd({ placement = 'banner', className = '' }) {\n  const [ads, setAds] = useState([]);\n  const [currentAdIndex, setCurrentAdIndex] = useState(0);\n  const [dismissed, setDismissed] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    setLoading(true);\n    setError(null);\n    const adsRef = collection(db, 'promoAds');\n    const q = query(adsRef, where('active', '==', true));\n    \n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const allAds = [];\n      snapshot.forEach((doc) => {\n        allAds.push({ id: doc.id, ...doc.data() });\n      });\n      const filteredAds = allAds.filter(ad => ad.placement === placement);\n      console.log(`PromoAd [${placement}]: Loaded ${filteredAds.length} ads (from ${allAds.length} total)`, filteredAds);\n      setAds(filteredAds);\n      setCurrentAdIndex(0);\n      setLoading(false);\n    }, (err) => {\n      console.error(`PromoAd [${placement}] error:`, err);\n      setError(err.message || 'Failed to load ads');\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [placement]);\n\n  useEffect(() => {\n    if (ads.length <= 1) return;\n    const interval = setInterval(() => {\n      setCurrentAdIndex((prev) => (prev + 1) % ads.length);\n    }, 8000);\n    return () => clearInterval(interval);\n  }, [ads.length]);\n\n  if (error) {\n    console.error(`PromoAd [${placement}] render error:`, error);\n    return null;\n  }\n\n  if (loading) return null;\n  \n  if (dismissed || ads.length === 0) return null;\n\n  const safeIndex = Math.min(currentAdIndex, ads.length - 1);\n  const currentAd = ads[safeIndex];\n  \n  if (!currentAd || !currentAd.imageUrl) return null;\n  \n  const isVideo = currentAd.mediaType === 'video';\n\n  const handleClick = () => {\n    if (currentAd.linkUrl) {\n      window.open(currentAd.linkUrl, '_blank', 'noopener,noreferrer');\n    }\n  };\n\n  return (\n    <div className={`p-4 ${className}`}>\n      <div \n        onClick={handleClick}\n        className={`relative overflow-hidden rounded-lg shadow-md ${currentAd.linkUrl ? 'cursor-pointer hover:shadow-lg transition-shadow' : ''}`}\n      >\n        {isVideo ? (\n          <video \n            src={currentAd.imageUrl}\n            className=\"w-full h-auto object-cover\"\n            style={{ maxHeight: placement === 'banner' ? '120px' : '250px' }}\n            autoPlay\n            muted\n            loop\n            playsInline\n          />\n        ) : (\n          <img \n            src={currentAd.imageUrl} \n            alt={currentAd.title || 'Promotion'}\n            className=\"w-full h-auto object-cover\"\n            style={{ maxHeight: placement === 'banner' ? '120px' : '250px' }}\n          />\n        )}\n        {currentAd.title && (\n          <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2\">\n            <p className=\"text-white text-sm font-medium truncate\">{currentAd.title}</p>\n          </div>\n        )}\n        <div className=\"absolute top-1 left-1 bg-black/50 text-white text-[10px] px-1.5 py-0.5 rounded\">\n          AD\n        </div>\n      </div>\n      <button\n        onClick={(e) => { e.stopPropagation(); setDismissed(true); }}\n        className=\"absolute top-1 right-1 p-1 bg-black/50 hover:bg-black/70 text-white rounded-full transition\"\n      >\n        <X className=\"w-3 h-3\" />\n      </button>\n      {ads.length > 1 && (\n        <div className=\"absolute bottom-2 right-2 flex gap-1\">\n          {ads.map((_, idx) => (\n            <div\n              key={idx}\n              className={`w-1.5 h-1.5 rounded-full transition ${idx === currentAdIndex ? 'bg-white' : 'bg-white/50'}`}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3945,"size_tokens":null},"src/components/AdManager.jsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { db, storage } from '../firebase';\nimport { Plus, Trash2, ExternalLink, Image, Video, ToggleLeft, ToggleRight, Loader2 } from 'lucide-react';\n\nconst PLACEMENTS = [\n  { id: 'banner', label: 'Top Banner' },\n  { id: 'sidebar', label: 'Sidebar' },\n  { id: 'inline', label: 'Inline (Between Sections)' },\n];\n\nexport default function AdManager() {\n  const [ads, setAds] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [showForm, setShowForm] = useState(false);\n  const [newAd, setNewAd] = useState({\n    title: '',\n    linkUrl: '',\n    placement: 'banner',\n  });\n  const fileInputRef = useRef(null);\n\n  useEffect(() => {\n    const adsRef = collection(db, 'promoAds');\n    const unsubscribe = onSnapshot(adsRef, (snapshot) => {\n      const adsList = [];\n      snapshot.forEach((doc) => {\n        adsList.push({ id: doc.id, ...doc.data() });\n      });\n      adsList.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));\n      setAds(adsList);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  const handleFileSelect = async (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    const isVideo = file.type.startsWith('video/');\n    const maxSize = isVideo ? 10 * 1024 * 1024 : 5 * 1024 * 1024;\n    if (file.size > maxSize) {\n      alert(`File too large. Maximum size is ${isVideo ? '10MB for videos' : '5MB for images'}.`);\n      return;\n    }\n\n    const validImageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n    const validVideoTypes = ['video/mp4', 'video/webm'];\n    const validTypes = [...validImageTypes, ...validVideoTypes];\n    if (!validTypes.includes(file.type)) {\n      alert('Invalid file type. Please upload JPG, PNG, GIF, WebP, MP4, or WebM.');\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      const timestamp = Date.now();\n      const fileExtension = file.name.split('.').pop();\n      const storagePath = `promoAds/${timestamp}.${fileExtension}`;\n      const storageRef = ref(storage, storagePath);\n\n      console.log('Uploading file to Storage...');\n      await uploadBytes(storageRef, file);\n      const downloadUrl = await getDownloadURL(storageRef);\n      console.log('File uploaded, URL:', downloadUrl);\n\n      const isVideoFile = file.type.startsWith('video/');\n      const adData = {\n        title: newAd.title || '',\n        linkUrl: newAd.linkUrl || '',\n        placement: newAd.placement,\n        imageUrl: downloadUrl,\n        mediaType: isVideoFile ? 'video' : 'image',\n        storagePath: storagePath,\n        active: true,\n        createdAt: timestamp,\n      };\n      \n      console.log('Saving ad metadata to Firestore...', adData);\n      const docRef = await addDoc(collection(db, 'promoAds'), adData);\n      console.log('Ad saved to Firestore successfully, ID:', docRef.id);\n      alert('Ad uploaded successfully!');\n\n      setNewAd({ title: '', linkUrl: '', placement: 'banner' });\n      setShowForm(false);\n      if (fileInputRef.current) fileInputRef.current.value = '';\n    } catch (error) {\n      console.error('Upload error:', error);\n      console.error('Error code:', error.code);\n      console.error('Error message:', error.message);\n      if (error.code === 'storage/unauthorized') {\n        alert('Upload failed: You do not have permission to upload ads. Make sure you are logged in with the admin account (djkrss1@gmail.com).');\n      } else if (error.code === 'storage/canceled') {\n        alert('Upload was cancelled.');\n      } else if (error.code === 'permission-denied') {\n        alert('Firestore permission denied: You do not have permission to save ad metadata. Make sure you are logged in with the admin account (djkrss1@gmail.com).');\n      } else {\n        alert(`Failed to upload ad: ${error.code || ''} - ${error.message || 'Please try again.'}`);\n      }\n    }\n\n    setIsUploading(false);\n  };\n\n  const toggleAdActive = async (ad) => {\n    try {\n      await updateDoc(doc(db, 'promoAds', ad.id), {\n        active: !ad.active,\n      });\n    } catch (error) {\n      console.error('Toggle error:', error);\n    }\n  };\n\n  const deleteAd = async (ad) => {\n    if (!confirm('Delete this ad?')) return;\n\n    try {\n      if (ad.storagePath) {\n        const storageRef = ref(storage, ad.storagePath);\n        await deleteObject(storageRef).catch(() => {});\n      }\n      await deleteDoc(doc(db, 'promoAds', ad.id));\n    } catch (error) {\n      console.error('Delete error:', error);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2\">\n            <Image className=\"w-5 h-5 text-orange-500\" />\n            Ad Manager\n          </h3>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            Upload promotional ads and flyers for free users\n          </p>\n        </div>\n        <button\n          onClick={() => setShowForm(!showForm)}\n          className=\"flex items-center gap-1 px-3 py-1.5 bg-orange-600 text-white text-sm rounded-lg hover:bg-orange-700 transition\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          New Ad\n        </button>\n      </div>\n\n      {showForm && (\n        <div className=\"bg-orange-50 dark:bg-orange-900/20 rounded-xl p-4 border border-orange-200 dark:border-orange-800 space-y-3\">\n          <div className=\"grid gap-3\">\n            <input\n              type=\"text\"\n              placeholder=\"Ad title (optional)\"\n              value={newAd.title}\n              onChange={(e) => setNewAd({ ...newAd, title: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            />\n            <input\n              type=\"url\"\n              placeholder=\"Link URL (optional) - where to go when clicked\"\n              value={newAd.linkUrl}\n              onChange={(e) => setNewAd({ ...newAd, linkUrl: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            />\n            <select\n              value={newAd.placement}\n              onChange={(e) => setNewAd({ ...newAd, placement: e.target.value })}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            >\n              {PLACEMENTS.map((p) => (\n                <option key={p.id} value={p.id}>{p.label}</option>\n              ))}\n            </select>\n          </div>\n          \n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*,video/mp4,video/webm\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n            id=\"ad-upload\"\n          />\n          <label\n            htmlFor=\"ad-upload\"\n            className={`flex flex-col items-center justify-center gap-2 px-4 py-4 border-2 border-dashed rounded-lg cursor-pointer transition ${\n              isUploading \n                ? 'border-gray-300 bg-gray-50 cursor-not-allowed' \n                : 'border-orange-300 hover:border-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/30'\n            }`}\n          >\n            {isUploading ? (\n              <>\n                <Loader2 className=\"w-5 h-5 animate-spin text-orange-500\" />\n                <span className=\"text-orange-600\">Uploading...</span>\n              </>\n            ) : (\n              <>\n                <div className=\"flex items-center gap-2\">\n                  <Image className=\"w-5 h-5 text-orange-500\" />\n                  <Video className=\"w-5 h-5 text-orange-500\" />\n                </div>\n                <span className=\"text-orange-600 font-medium\">\n                  Click to upload image or video\n                </span>\n                <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Images: max 5MB (1200x300 recommended) | Videos: max 10MB (MP4, WebM)\n                </span>\n              </>\n            )}\n          </label>\n        </div>\n      )}\n\n      {ads.length > 0 ? (\n        <div className=\"space-y-3\">\n          {ads.map((ad) => (\n            <div\n              key={ad.id}\n              className={`flex items-center gap-4 p-3 rounded-lg border transition ${\n                ad.active \n                  ? 'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600' \n                  : 'bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 opacity-60'\n              }`}\n            >\n              {ad.mediaType === 'video' ? (\n                <video\n                  src={ad.imageUrl}\n                  className=\"w-20 h-14 object-cover rounded\"\n                  muted\n                />\n              ) : (\n                <img\n                  src={ad.imageUrl}\n                  alt={ad.title || 'Ad'}\n                  className=\"w-20 h-14 object-cover rounded\"\n                />\n              )}\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-medium text-gray-800 dark:text-white truncate\">\n                  {ad.title || 'Untitled Ad'}\n                </p>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  {PLACEMENTS.find(p => p.id === ad.placement)?.label || ad.placement}\n                  {ad.linkUrl && ' ‚Ä¢ Has link'}\n                </p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => toggleAdActive(ad)}\n                  className={`p-2 rounded-lg transition ${ad.active ? 'text-green-600 hover:bg-green-50' : 'text-gray-400 hover:bg-gray-100'}`}\n                  title={ad.active ? 'Active - Click to disable' : 'Inactive - Click to enable'}\n                >\n                  {ad.active ? <ToggleRight className=\"w-5 h-5\" /> : <ToggleLeft className=\"w-5 h-5\" />}\n                </button>\n                {ad.linkUrl && (\n                  <a\n                    href={ad.linkUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\n                  >\n                    <ExternalLink className=\"w-4 h-4\" />\n                  </a>\n                )}\n                <button\n                  onClick={() => deleteAd(ad)}\n                  className=\"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n          <Image className=\"w-16 h-16 mx-auto mb-3 opacity-30\" />\n          <p className=\"font-medium\">No ads uploaded yet</p>\n          <p className=\"text-sm\">Upload flyers and promotions to show to free users</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11216,"size_tokens":null},"src/components/SplashPage.jsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Calendar, MapPin, Users, Wallet, Shirt, CheckSquare, Zap, Image, Wifi, Crown, ChevronDown, Sparkles } from 'lucide-react';\n\nconst carnivals = [\n  { name: 'Trinidad', color: 'from-red-500 to-pink-500', month: 'February' },\n  { name: 'Jamaica', color: 'from-green-500 to-yellow-500', month: 'April' },\n  { name: 'St. Lucia', color: 'from-blue-400 to-cyan-400', month: 'July' },\n  { name: 'Antigua', color: 'from-orange-500 to-red-500', month: 'August' },\n  { name: 'Miami', color: 'from-pink-500 to-purple-500', month: 'October' },\n  { name: 'Notting Hill', color: 'from-purple-500 to-indigo-500', month: 'August' },\n];\n\nconst freeFeatures = [\n  { icon: Wallet, title: 'Budget Planner', desc: 'Track every dollar of your carnival spend' },\n  { icon: Shirt, title: 'Costume Tracker', desc: 'Band, section & payment tracking' },\n  { icon: Calendar, title: 'Event Scheduler', desc: 'Curated fetes + your custom events' },\n  { icon: Users, title: 'Squad Coordination', desc: 'Share plans with your crew via code' },\n  { icon: CheckSquare, title: 'Packing List', desc: 'Never forget your essentials' },\n  { icon: Zap, title: 'Road Ready Mode', desc: 'Quick-glance view for carnival day' },\n];\n\nconst premiumFeatures = [\n  { icon: MapPin, title: 'Interactive Fete Map', desc: 'Pin accommodations, fetes, costume pickups & meetup spots with distance calculations' },\n  { icon: Image, title: 'Media Vault', desc: 'Upload tickets, photos & documents for each carnival' },\n  { icon: Wifi, title: 'Offline Mode', desc: 'Access your plans without internet' },\n  { icon: Crown, title: 'Ad-Free Experience', desc: 'No promotional interruptions' },\n];\n\nexport default function SplashPage({ onGetStarted, logo, onLegalPage }) {\n  const [scrollY, setScrollY] = useState(0);\n  const [activeCarousel, setActiveCarousel] = useState(0);\n\n  useEffect(() => {\n    const handleScroll = () => setScrollY(window.scrollY);\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setActiveCarousel((prev) => (prev + 1) % carnivals.length);\n    }, 3000);\n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-slate-950 text-white overflow-x-hidden\">\n      {/* Animated Background */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div \n          className=\"absolute w-[800px] h-[800px] bg-gradient-to-r from-pink-500/30 to-purple-500/30 rounded-full blur-3xl\"\n          style={{ \n            top: -200 + scrollY * 0.1, \n            right: -200,\n            transform: `rotate(${scrollY * 0.02}deg)`\n          }}\n        />\n        <div \n          className=\"absolute w-[600px] h-[600px] bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-full blur-3xl\"\n          style={{ \n            bottom: -100 + scrollY * 0.05, \n            left: -100 \n          }}\n        />\n        <div \n          className=\"absolute w-[500px] h-[500px] bg-gradient-to-r from-cyan-500/15 to-blue-500/15 rounded-full blur-3xl\"\n          style={{ \n            top: '40%', \n            left: '50%',\n            transform: `translate(-50%, -50%) scale(${1 + scrollY * 0.0005})`\n          }}\n        />\n      </div>\n\n      {/* Hero Section */}\n      <section className=\"relative min-h-screen flex flex-col items-center justify-center px-6\">\n        <div className=\"text-center max-w-4xl mx-auto\">\n          {/* Logo with glow */}\n          <div className=\"mb-8 relative inline-block\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-yellow-500 rounded-3xl blur-2xl opacity-60 animate-pulse scale-110\" />\n            <img \n              src={logo} \n              alt=\"Carnival Planner\" \n              className=\"relative w-32 h-32 md:w-40 md:h-40 rounded-3xl shadow-2xl border-2 border-white/20\" \n            />\n          </div>\n\n          {/* Title */}\n          <h1 className=\"text-5xl md:text-7xl font-black mb-6 leading-tight\">\n            <span className=\"bg-gradient-to-r from-white via-pink-200 to-white bg-clip-text text-transparent\">\n              Plan Your\n            </span>\n            <br />\n            <span className=\"bg-gradient-to-r from-pink-400 via-yellow-300 to-orange-400 bg-clip-text text-transparent\">\n              Perfect Carnival\n            </span>\n          </h1>\n\n          {/* Subtitle */}\n          <p className=\"text-xl md:text-2xl text-gray-400 mb-12 max-w-2xl mx-auto leading-relaxed\">\n            The ultimate planning companion for <span className=\"text-white font-semibold\">15+ Caribbean carnivals</span>. \n            Budget, schedule, squad coordination ‚Äî all in one place.\n          </p>\n\n          {/* CTA Buttons */}\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-16\">\n            <button \n              onClick={onGetStarted}\n              className=\"group relative px-10 py-5 bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 rounded-2xl font-bold text-xl shadow-2xl shadow-pink-500/30 hover:shadow-pink-500/50 transition-all duration-300 hover:scale-105 overflow-hidden\"\n            >\n              <span className=\"relative z-10 flex items-center justify-center gap-2\">\n                Get Started Free\n                <Sparkles className=\"w-5 h-5\" />\n              </span>\n              <div className=\"absolute inset-0 bg-gradient-to-r from-pink-600 via-red-600 to-yellow-600 opacity-0 group-hover:opacity-100 transition-opacity\" />\n            </button>\n          </div>\n\n          {/* Trust badge */}\n          <p className=\"text-gray-500 text-sm flex items-center justify-center gap-2\">\n            <Crown className=\"w-4 h-4 text-yellow-500\" />\n            Free forever for core features. Premium available for power users.\n          </p>\n        </div>\n\n        {/* Scroll indicator */}\n        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce\">\n          <ChevronDown className=\"w-8 h-8 text-gray-500\" />\n        </div>\n      </section>\n\n      {/* Carnival Preview Carousel */}\n      <section className=\"relative py-24 px-6\">\n        <div className=\"max-w-6xl mx-auto\">\n          <h2 className=\"text-3xl md:text-4xl font-bold text-center mb-4\">\n            <span className=\"bg-gradient-to-r from-pink-400 to-yellow-400 bg-clip-text text-transparent\">\n              15+ Caribbean Carnivals\n            </span>\n          </h2>\n          <p className=\"text-gray-400 text-center mb-12 text-lg\">\n            From Trinidad to Miami, we've got your carnival season covered\n          </p>\n\n          {/* Carousel */}\n          <div className=\"relative overflow-hidden rounded-3xl bg-white/5 backdrop-blur-sm border border-white/10 p-8\">\n            <div className=\"flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-hide\">\n              {carnivals.map((carnival, idx) => (\n                <div \n                  key={carnival.name}\n                  className={`flex-shrink-0 w-48 h-32 rounded-2xl bg-gradient-to-br ${carnival.color} p-4 flex flex-col justify-between snap-center transition-all duration-500 ${\n                    idx === activeCarousel ? 'scale-105 shadow-2xl' : 'opacity-70'\n                  }`}\n                >\n                  <span className=\"text-white font-bold text-lg\">{carnival.name}</span>\n                  <span className=\"text-white/80 text-sm\">{carnival.month}</span>\n                </div>\n              ))}\n            </div>\n            \n            {/* Carousel indicators */}\n            <div className=\"flex justify-center gap-2 mt-6\">\n              {carnivals.map((_, idx) => (\n                <button\n                  key={idx}\n                  onClick={() => setActiveCarousel(idx)}\n                  className={`w-2 h-2 rounded-full transition-all ${\n                    idx === activeCarousel ? 'bg-white w-6' : 'bg-white/30'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Free Features Section */}\n      <section className=\"relative py-24 px-6 bg-gradient-to-b from-transparent via-purple-950/30 to-transparent\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <span className=\"inline-block px-4 py-2 bg-green-500/20 text-green-400 rounded-full text-sm font-semibold mb-4\">\n              100% FREE\n            </span>\n            <h2 className=\"text-3xl md:text-5xl font-bold mb-4\">\n              Everything You Need to Plan\n            </h2>\n            <p className=\"text-gray-400 text-lg max-w-2xl mx-auto\">\n              All core planning features are completely free. No credit card, no trial limits.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {freeFeatures.map((feature, idx) => (\n              <div \n                key={feature.title}\n                className=\"group bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6 hover:bg-white/10 hover:border-white/20 transition-all duration-300 hover:scale-[1.02]\"\n              >\n                <div className=\"w-14 h-14 bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\n                  <feature.icon className=\"w-7 h-7 text-green-400\" />\n                </div>\n                <h3 className=\"text-xl font-bold mb-2\">{feature.title}</h3>\n                <p className=\"text-gray-400\">{feature.desc}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Premium Features Section */}\n      <section className=\"relative py-24 px-6\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-16\">\n            <span className=\"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 text-yellow-400 rounded-full text-sm font-semibold mb-4\">\n              <Crown className=\"w-4 h-4\" />\n              PREMIUM\n            </span>\n            <h2 className=\"text-3xl md:text-5xl font-bold mb-4\">\n              <span className=\"bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent\">\n                Level Up Your Experience\n              </span>\n            </h2>\n            <p className=\"text-gray-400 text-lg max-w-2xl mx-auto\">\n              Unlock powerful features for the ultimate carnival planning experience\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-12\">\n            {premiumFeatures.map((feature) => (\n              <div \n                key={feature.title}\n                className=\"group relative bg-gradient-to-br from-yellow-500/10 via-orange-500/5 to-pink-500/10 border border-yellow-500/20 rounded-2xl p-6 hover:border-yellow-500/40 transition-all duration-300\"\n              >\n                <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-yellow-500/10 to-transparent rounded-bl-full\" />\n                <div className=\"relative\">\n                  <div className=\"w-14 h-14 bg-gradient-to-br from-yellow-500/30 to-orange-500/30 rounded-xl flex items-center justify-center mb-4\">\n                    <feature.icon className=\"w-7 h-7 text-yellow-400\" />\n                  </div>\n                  <h3 className=\"text-xl font-bold mb-2\">{feature.title}</h3>\n                  <p className=\"text-gray-400\">{feature.desc}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {/* Pricing callout */}\n          <div className=\"text-center bg-gradient-to-r from-yellow-500/10 via-orange-500/10 to-pink-500/10 border border-yellow-500/20 rounded-3xl p-8\">\n            <p className=\"text-2xl font-bold mb-2\">\n              <span className=\"text-yellow-400\">$4.99/month</span>\n              <span className=\"text-gray-500 mx-3\">or</span>\n              <span className=\"text-yellow-400\">$39.99/year</span>\n              <span className=\"text-green-400 text-sm ml-2\">(Save 33%)</span>\n            </p>\n            <p className=\"text-gray-400\">Cancel anytime. No commitments.</p>\n          </div>\n        </div>\n      </section>\n\n      {/* Final CTA Section */}\n      <section className=\"relative py-32 px-6\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          <h2 className=\"text-4xl md:text-6xl font-black mb-6\">\n            Ready to Plan Your\n            <br />\n            <span className=\"bg-gradient-to-r from-pink-400 via-yellow-300 to-orange-400 bg-clip-text text-transparent\">\n              Best Carnival Yet?\n            </span>\n          </h2>\n          <p className=\"text-xl text-gray-400 mb-12\">\n            Join thousands of carnival enthusiasts planning their perfect experience\n          </p>\n          \n          <button \n            onClick={onGetStarted}\n            className=\"group relative px-12 py-6 bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 rounded-2xl font-bold text-2xl shadow-2xl shadow-pink-500/30 hover:shadow-pink-500/50 transition-all duration-300 hover:scale-105\"\n          >\n            <span className=\"relative z-10\">Start Planning Now</span>\n            <div className=\"absolute inset-0 bg-gradient-to-r from-pink-600 via-red-600 to-yellow-600 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity\" />\n          </button>\n\n          <p className=\"mt-8 text-gray-500\">\n            Free to use. Sign in with Google to get started.\n          </p>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"border-t border-white/10 py-8 px-6\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <img src={logo} alt=\"Logo\" className=\"w-8 h-8 rounded-lg\" />\n            <span className=\"font-bold\">Carnival Planner</span>\n          </div>\n          <p className=\"text-gray-500 text-sm text-center mb-6\">\n            Plan your Mas. Track your Fetes. Coordinate your Squad.\n          </p>\n          \n          {/* Legal Links */}\n          <div className=\"flex flex-wrap justify-center gap-4 text-sm text-gray-500\">\n            <button \n              onClick={() => onLegalPage?.('privacy')} \n              className=\"hover:text-white transition-colors\"\n            >\n              Privacy Policy\n            </button>\n            <span className=\"text-gray-700\">|</span>\n            <button \n              onClick={() => onLegalPage?.('terms')} \n              className=\"hover:text-white transition-colors\"\n            >\n              Terms of Service\n            </button>\n            <span className=\"text-gray-700\">|</span>\n            <button \n              onClick={() => onLegalPage?.('cookies')} \n              className=\"hover:text-white transition-colors\"\n            >\n              Cookie Policy\n            </button>\n            <span className=\"text-gray-700\">|</span>\n            <button \n              onClick={() => onLegalPage?.('refund')} \n              className=\"hover:text-white transition-colors\"\n            >\n              Refund Policy\n            </button>\n            <span className=\"text-gray-700\">|</span>\n            <button \n              onClick={() => onLegalPage?.('contact')} \n              className=\"hover:text-white transition-colors\"\n            >\n              Contact Us\n            </button>\n          </div>\n          \n          <p className=\"text-gray-600 text-xs text-center mt-6\">\n            ¬© {new Date().getFullYear()} Carnival Planner. All rights reserved.\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":15749,"size_tokens":null},"public/sw.js":{"content":"const CACHE_NAME = 'carnival-planner-v2';\nconst STATIC_CACHE = 'carnival-static-v2';\nconst DYNAMIC_CACHE = 'carnival-dynamic-v2';\n\nconst STATIC_ASSETS = [\n  '/',\n  '/index.html',\n  '/manifest.json',\n  '/fete192x192.png',\n];\n\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(STATIC_CACHE).then((cache) => {\n      return cache.addAll(STATIC_ASSETS);\n    })\n  );\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames\n          .filter((name) => name !== STATIC_CACHE && name !== DYNAMIC_CACHE)\n          .map((name) => caches.delete(name))\n      );\n    })\n  );\n  self.clients.claim();\n});\n\nself.addEventListener('fetch', (event) => {\n  if (event.request.method !== 'GET') return;\n  \n  const url = new URL(event.request.url);\n  \n  if (url.pathname.startsWith('/assets/') || \n      url.pathname.endsWith('.js') || \n      url.pathname.endsWith('.css') ||\n      url.pathname.endsWith('.png') ||\n      url.pathname.endsWith('.jpg') ||\n      url.pathname.endsWith('.svg')) {\n    event.respondWith(\n      caches.open(STATIC_CACHE).then((cache) => {\n        return cache.match(event.request).then((cached) => {\n          if (cached) return cached;\n          return fetch(event.request).then((response) => {\n            if (response.ok) {\n              cache.put(event.request, response.clone());\n            }\n            return response;\n          });\n        });\n      })\n    );\n    return;\n  }\n  \n  if (url.origin === location.origin && \n      !url.pathname.includes('firestore') && \n      !url.pathname.includes('firebase')) {\n    event.respondWith(\n      fetch(event.request)\n        .then((response) => {\n          if (response.ok) {\n            const clone = response.clone();\n            caches.open(DYNAMIC_CACHE).then((cache) => {\n              cache.put(event.request, clone);\n            });\n          }\n          return response;\n        })\n        .catch(() => {\n          return caches.match(event.request).then((cached) => {\n            return cached || caches.match('/index.html');\n          });\n        })\n    );\n  }\n});\n\nself.addEventListener('message', (event) => {\n  if (event.data && event.data.type === 'SKIP_WAITING') {\n    self.skipWaiting();\n  }\n});\n","path":null,"size_bytes":2322,"size_tokens":null},"src/components/LegalPages.jsx":{"content":"import React from 'react';\nimport { ArrowLeft, Shield, FileText, Cookie, CreditCard } from 'lucide-react';\n\nconst COMPANY_NAME = 'Carnival Planner';\nconst COMPANY_EMAIL = 'support@carnival-planner.com';\nconst LAST_UPDATED = 'December 12, 2025';\n\nexport function PrivacyPolicy({ onBack, logo }) {\n  return (\n    <LegalPageWrapper title=\"Privacy Policy\" icon={Shield} onBack={onBack} logo={logo}>\n      <p className=\"text-gray-400 mb-6\">Last Updated: {LAST_UPDATED}</p>\n      \n      <Section title=\"1. Introduction\">\n        <p>{COMPANY_NAME} (\"we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our mobile application and website (collectively, the \"Service\").</p>\n      </Section>\n\n      <Section title=\"2. Information We Collect\">\n        <h4 className=\"font-semibold text-white mb-2\">2.1 Personal Information</h4>\n        <p className=\"mb-4\">When you sign in with Google, we collect:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li>Email address</li>\n          <li>Display name</li>\n          <li>Profile picture URL</li>\n          <li>Google account unique identifier</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">2.2 User-Generated Content</h4>\n        <p className=\"mb-4\">Information you voluntarily provide includes:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li>Carnival planning data (budgets, schedules, packing lists)</li>\n          <li>Costume and band information</li>\n          <li>Squad member names and coordination data</li>\n          <li>Uploaded media files (tickets, photos, documents)</li>\n          <li>Map pins and location notes</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">2.3 Payment Information</h4>\n        <p>For premium subscriptions, payment processing is handled securely by Stripe. We do not store your credit card numbers. We receive only transaction confirmation, subscription status, and billing email from Stripe.</p>\n      </Section>\n\n      <Section title=\"3. How We Use Your Information\">\n        <ul className=\"list-disc list-inside space-y-2\">\n          <li>To provide and maintain the Service</li>\n          <li>To authenticate your identity via Google Sign-In</li>\n          <li>To process premium subscription payments via Stripe</li>\n          <li>To sync your carnival planning data across devices</li>\n          <li>To send push notifications for squad alerts (if enabled)</li>\n          <li>To improve and optimize our Service</li>\n          <li>To respond to your inquiries and support requests</li>\n        </ul>\n      </Section>\n\n      <Section title=\"4. Data Storage and Security\">\n        <p className=\"mb-4\">Your data is stored using Firebase services provided by Google:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li><strong>Firebase Authentication:</strong> Manages secure sign-in</li>\n          <li><strong>Cloud Firestore:</strong> Stores your planning data</li>\n          <li><strong>Firebase Storage:</strong> Stores uploaded media files</li>\n          <li><strong>Firebase Cloud Messaging:</strong> Delivers push notifications</li>\n        </ul>\n        <p>We implement industry-standard security measures including encryption in transit (TLS) and at rest. Firebase services are SOC 2 and ISO 27001 certified.</p>\n      </Section>\n\n      <Section title=\"5. Third-Party Services\">\n        <p className=\"mb-4\">We use the following third-party services:</p>\n        <ul className=\"list-disc list-inside space-y-2\">\n          <li><strong>Google (Firebase):</strong> Authentication, database, storage, and hosting. <a href=\"https://firebase.google.com/support/privacy\" className=\"text-pink-400 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">Firebase Privacy Policy</a></li>\n          <li><strong>Stripe:</strong> Payment processing. <a href=\"https://stripe.com/privacy\" className=\"text-pink-400 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">Stripe Privacy Policy</a></li>\n          <li><strong>OpenStreetMap:</strong> Map tiles for the Fete Map feature. <a href=\"https://wiki.osmfoundation.org/wiki/Privacy_Policy\" className=\"text-pink-400 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">OSM Privacy Policy</a></li>\n        </ul>\n      </Section>\n\n      <Section title=\"6. Your Rights (GDPR/CCPA)\">\n        <p className=\"mb-4\">Depending on your location, you may have the following rights:</p>\n        <ul className=\"list-disc list-inside space-y-2\">\n          <li><strong>Access:</strong> Request a copy of your personal data</li>\n          <li><strong>Rectification:</strong> Correct inaccurate personal data</li>\n          <li><strong>Erasure:</strong> Request deletion of your personal data</li>\n          <li><strong>Portability:</strong> Receive your data in a portable format</li>\n          <li><strong>Opt-out:</strong> Opt out of certain data processing</li>\n          <li><strong>Non-discrimination:</strong> We will not discriminate against you for exercising your rights</li>\n        </ul>\n        <p className=\"mt-4\">To exercise these rights, contact us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a>.</p>\n      </Section>\n\n      <Section title=\"7. Data Retention\">\n        <p>We retain your personal data for as long as your account is active. If you delete your account, we will delete your data within 30 days, except where we are legally required to retain it.</p>\n      </Section>\n\n      <Section title=\"8. Children's Privacy\">\n        <p>Our Service is not intended for children under 13. We do not knowingly collect personal information from children under 13. If you believe we have collected such information, please contact us immediately.</p>\n      </Section>\n\n      <Section title=\"9. Changes to This Policy\">\n        <p>We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the \"Last Updated\" date.</p>\n      </Section>\n\n      <Section title=\"10. Contact Us\">\n        <p>If you have questions about this Privacy Policy, please contact us at:</p>\n        <p className=\"mt-2\"><a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a></p>\n      </Section>\n    </LegalPageWrapper>\n  );\n}\n\nexport function TermsOfService({ onBack, logo }) {\n  return (\n    <LegalPageWrapper title=\"Terms of Service\" icon={FileText} onBack={onBack} logo={logo}>\n      <p className=\"text-gray-400 mb-6\">Last Updated: {LAST_UPDATED}</p>\n\n      <Section title=\"1. Acceptance of Terms\">\n        <p>By accessing or using {COMPANY_NAME} (\"the Service\"), you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use the Service.</p>\n      </Section>\n\n      <Section title=\"2. Description of Service\">\n        <p>{COMPANY_NAME} is a Progressive Web App that helps users plan and organize Caribbean carnival events. The Service includes free features (budget planning, scheduling, squad coordination) and premium subscription features (interactive maps, media vault, offline mode).</p>\n      </Section>\n\n      <Section title=\"3. User Accounts\">\n        <h4 className=\"font-semibold text-white mb-2\">3.1 Registration</h4>\n        <p className=\"mb-4\">You must sign in with a valid Google account to use the Service. You are responsible for maintaining the security of your account.</p>\n        \n        <h4 className=\"font-semibold text-white mb-2\">3.2 Account Responsibilities</h4>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>You must provide accurate information</li>\n          <li>You are responsible for all activities under your account</li>\n          <li>You must notify us immediately of any unauthorized use</li>\n        </ul>\n      </Section>\n\n      <Section title=\"4. Premium Subscriptions\">\n        <h4 className=\"font-semibold text-white mb-2\">4.1 Subscription Plans</h4>\n        <p className=\"mb-4\">We offer monthly ($4.99/month) and yearly ($39.99/year) subscription plans. Prices are subject to change with reasonable notice.</p>\n\n        <h4 className=\"font-semibold text-white mb-2\">4.2 Billing</h4>\n        <p className=\"mb-4\">Subscriptions are billed in advance on a recurring basis. Payment is processed through Stripe. Your subscription will automatically renew unless you cancel before the renewal date.</p>\n\n        <h4 className=\"font-semibold text-white mb-2\">4.3 Cancellation</h4>\n        <p>You may cancel your subscription at any time. You will continue to have access to premium features until the end of your current billing period. See our Refund Policy for details.</p>\n      </Section>\n\n      <Section title=\"5. User Content\">\n        <h4 className=\"font-semibold text-white mb-2\">5.1 Your Content</h4>\n        <p className=\"mb-4\">You retain ownership of all content you upload to the Service (schedules, media, notes). By uploading content, you grant us a limited license to store, display, and process it to provide the Service.</p>\n\n        <h4 className=\"font-semibold text-white mb-2\">5.2 Content Restrictions</h4>\n        <p className=\"mb-2\">You agree not to upload content that:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Is illegal, harmful, or offensive</li>\n          <li>Infringes on intellectual property rights</li>\n          <li>Contains malware or malicious code</li>\n          <li>Violates others' privacy</li>\n        </ul>\n      </Section>\n\n      <Section title=\"6. Acceptable Use\">\n        <p className=\"mb-2\">You agree not to:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Use the Service for any unlawful purpose</li>\n          <li>Attempt to gain unauthorized access to our systems</li>\n          <li>Interfere with or disrupt the Service</li>\n          <li>Reverse engineer or decompile the Service</li>\n          <li>Use automated systems to access the Service without permission</li>\n        </ul>\n      </Section>\n\n      <Section title=\"7. Intellectual Property\">\n        <p>The Service, including its design, features, and content (excluding user content), is owned by {COMPANY_NAME} and protected by intellectual property laws. You may not copy, modify, or distribute our intellectual property without permission.</p>\n      </Section>\n\n      <Section title=\"8. Disclaimer of Warranties\">\n        <p>THE SERVICE IS PROVIDED \"AS IS\" WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED. WE DO NOT GUARANTEE THAT THE SERVICE WILL BE UNINTERRUPTED, ERROR-FREE, OR SECURE. YOUR USE OF THE SERVICE IS AT YOUR OWN RISK.</p>\n      </Section>\n\n      <Section title=\"9. Limitation of Liability\">\n        <p>TO THE MAXIMUM EXTENT PERMITTED BY LAW, {COMPANY_NAME.toUpperCase()} SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES ARISING FROM YOUR USE OF THE SERVICE, EVEN IF WE HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>\n      </Section>\n\n      <Section title=\"10. Termination\">\n        <p>We may terminate or suspend your account at any time for violation of these Terms. You may delete your account at any time. Upon termination, your right to use the Service will immediately cease.</p>\n      </Section>\n\n      <Section title=\"11. Governing Law\">\n        <p>These Terms shall be governed by the laws of the jurisdiction in which {COMPANY_NAME} operates, without regard to conflict of law principles.</p>\n      </Section>\n\n      <Section title=\"12. Changes to Terms\">\n        <p>We may modify these Terms at any time. We will notify you of significant changes via email or in-app notification. Continued use of the Service after changes constitutes acceptance of the new Terms.</p>\n      </Section>\n\n      <Section title=\"13. Contact\">\n        <p>For questions about these Terms, contact us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a>.</p>\n      </Section>\n    </LegalPageWrapper>\n  );\n}\n\nexport function CookiePolicy({ onBack, logo }) {\n  return (\n    <LegalPageWrapper title=\"Cookie Policy\" icon={Cookie} onBack={onBack} logo={logo}>\n      <p className=\"text-gray-400 mb-6\">Last Updated: {LAST_UPDATED}</p>\n\n      <Section title=\"1. What Are Cookies\">\n        <p>Cookies are small text files stored on your device when you visit a website. They help websites remember your preferences and improve your experience.</p>\n      </Section>\n\n      <Section title=\"2. How We Use Cookies\">\n        <p className=\"mb-4\">{COMPANY_NAME} uses cookies and similar technologies for the following purposes:</p>\n        \n        <h4 className=\"font-semibold text-white mb-2\">2.1 Essential Cookies (Required)</h4>\n        <p className=\"mb-4\">These cookies are necessary for the Service to function and cannot be disabled:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li><strong>Firebase Authentication:</strong> Maintains your signed-in session securely</li>\n          <li><strong>Session Management:</strong> Remembers your authentication state</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">2.2 Functional Cookies</h4>\n        <p className=\"mb-4\">These cookies enhance your experience:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li><strong>Preferences:</strong> Remembers your dark mode setting</li>\n          <li><strong>Local Storage:</strong> Caches carnival data for offline access (Premium feature)</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">2.3 Third-Party Cookies</h4>\n        <p className=\"mb-2\">Our third-party services may set their own cookies:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li><strong>Firebase/Google:</strong> Authentication and analytics</li>\n          <li><strong>Stripe:</strong> Payment processing security</li>\n        </ul>\n      </Section>\n\n      <Section title=\"3. Cookie Details\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left text-sm mb-4\">\n            <thead>\n              <tr className=\"border-b border-gray-700\">\n                <th className=\"py-2 pr-4\">Cookie Name</th>\n                <th className=\"py-2 pr-4\">Purpose</th>\n                <th className=\"py-2 pr-4\">Duration</th>\n                <th className=\"py-2\">Type</th>\n              </tr>\n            </thead>\n            <tbody className=\"text-gray-400\">\n              <tr className=\"border-b border-gray-800\">\n                <td className=\"py-2 pr-4\">firebase-auth</td>\n                <td className=\"py-2 pr-4\">User authentication</td>\n                <td className=\"py-2 pr-4\">Session</td>\n                <td className=\"py-2\">Essential</td>\n              </tr>\n              <tr className=\"border-b border-gray-800\">\n                <td className=\"py-2 pr-4\">__stripe_mid</td>\n                <td className=\"py-2 pr-4\">Fraud prevention</td>\n                <td className=\"py-2 pr-4\">1 year</td>\n                <td className=\"py-2\">Essential</td>\n              </tr>\n              <tr className=\"border-b border-gray-800\">\n                <td className=\"py-2 pr-4\">darkMode</td>\n                <td className=\"py-2 pr-4\">Theme preference</td>\n                <td className=\"py-2 pr-4\">Persistent</td>\n                <td className=\"py-2\">Functional</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </Section>\n\n      <Section title=\"4. Local Storage\">\n        <p className=\"mb-4\">In addition to cookies, we use browser local storage for:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Caching carnival data for offline access (Premium)</li>\n          <li>Storing FCM tokens for push notifications</li>\n          <li>Temporary UI state</li>\n        </ul>\n      </Section>\n\n      <Section title=\"5. Managing Cookies\">\n        <p className=\"mb-4\">You can manage cookies through your browser settings:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li><strong>Chrome:</strong> Settings ‚Üí Privacy and security ‚Üí Cookies</li>\n          <li><strong>Firefox:</strong> Settings ‚Üí Privacy & Security ‚Üí Cookies</li>\n          <li><strong>Safari:</strong> Preferences ‚Üí Privacy ‚Üí Cookies</li>\n          <li><strong>Edge:</strong> Settings ‚Üí Cookies and site permissions</li>\n        </ul>\n        <p className=\"mt-4 text-yellow-400\">Note: Disabling essential cookies may prevent you from using the Service.</p>\n      </Section>\n\n      <Section title=\"6. Updates to This Policy\">\n        <p>We may update this Cookie Policy to reflect changes in our practices or for legal reasons. Check this page periodically for updates.</p>\n      </Section>\n\n      <Section title=\"7. Contact\">\n        <p>For questions about our use of cookies, contact us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a>.</p>\n      </Section>\n    </LegalPageWrapper>\n  );\n}\n\nexport function RefundPolicy({ onBack, logo }) {\n  return (\n    <LegalPageWrapper title=\"Refund Policy\" icon={CreditCard} onBack={onBack} logo={logo}>\n      <p className=\"text-gray-400 mb-6\">Last Updated: {LAST_UPDATED}</p>\n\n      <Section title=\"1. Premium Subscription\">\n        <p>{COMPANY_NAME} offers premium subscriptions at $4.99/month or $39.99/year. This policy explains our refund terms for these subscriptions.</p>\n      </Section>\n\n      <Section title=\"2. Subscription Cancellation\">\n        <h4 className=\"font-semibold text-white mb-2\">2.1 How to Cancel</h4>\n        <p className=\"mb-4\">You can cancel your subscription at any time by:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li>Contacting us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a></li>\n          <li>Managing your subscription through Stripe's customer portal (link provided in your confirmation email)</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">2.2 Effect of Cancellation</h4>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Your premium access continues until the end of your current billing period</li>\n          <li>You will not be charged again after cancellation</li>\n          <li>No partial refunds are provided for unused time in the current billing period</li>\n        </ul>\n      </Section>\n\n      <Section title=\"3. Refund Eligibility\">\n        <h4 className=\"font-semibold text-white mb-2\">3.1 Eligible for Refund</h4>\n        <p className=\"mb-2\">We offer refunds in the following situations:</p>\n        <ul className=\"list-disc list-inside mb-4 space-y-1\">\n          <li><strong>Technical Issues:</strong> If the Service was unavailable or significantly impaired for an extended period</li>\n          <li><strong>Accidental Purchase:</strong> If you accidentally subscribed and request a refund within 48 hours, without using premium features</li>\n          <li><strong>Duplicate Charges:</strong> If you were charged multiple times for the same subscription period</li>\n        </ul>\n\n        <h4 className=\"font-semibold text-white mb-2\">3.2 Not Eligible for Refund</h4>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Change of mind after using premium features</li>\n          <li>Requests made after 30 days from the charge date</li>\n          <li>Failure to cancel before renewal (you must cancel before renewal to avoid charges)</li>\n          <li>Issues caused by your device, browser, or internet connection</li>\n        </ul>\n      </Section>\n\n      <Section title=\"4. How to Request a Refund\">\n        <p className=\"mb-4\">To request a refund:</p>\n        <ol className=\"list-decimal list-inside space-y-2\">\n          <li>Email us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a></li>\n          <li>Include your account email and the date of the charge</li>\n          <li>Explain the reason for your refund request</li>\n        </ol>\n        <p className=\"mt-4\">We will review your request and respond within 5 business days.</p>\n      </Section>\n\n      <Section title=\"5. Refund Processing\">\n        <p className=\"mb-4\">If your refund is approved:</p>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Refunds are processed through Stripe to your original payment method</li>\n          <li>Allow 5-10 business days for the refund to appear on your statement</li>\n          <li>Your premium access will be revoked upon refund</li>\n        </ul>\n      </Section>\n\n      <Section title=\"6. Free Trial\">\n        <p>We do not currently offer free trials. All core features are free to use. Premium features require a paid subscription.</p>\n      </Section>\n\n      <Section title=\"7. Price Changes\">\n        <p>If we increase subscription prices, existing subscribers will be notified at least 30 days in advance. You may cancel before the new price takes effect to avoid being charged at the higher rate.</p>\n      </Section>\n\n      <Section title=\"8. Contact\">\n        <p>For refund requests or questions about this policy, contact us at <a href={`mailto:${COMPANY_EMAIL}`} className=\"text-pink-400 hover:underline\">{COMPANY_EMAIL}</a>.</p>\n      </Section>\n    </LegalPageWrapper>\n  );\n}\n\nfunction LegalPageWrapper({ title, icon: Icon, onBack, logo, children }) {\n  return (\n    <div className=\"min-h-screen bg-slate-950 text-white\">\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute w-[600px] h-[600px] bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-full blur-3xl -top-48 -right-48\" />\n        <div className=\"absolute w-[400px] h-[400px] bg-gradient-to-r from-blue-500/15 to-cyan-500/15 rounded-full blur-3xl bottom-0 left-0\" />\n      </div>\n      \n      <div className=\"relative max-w-4xl mx-auto px-6 py-12\">\n        <button\n          onClick={onBack}\n          className=\"flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-8\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n          Back\n        </button>\n\n        <div className=\"flex items-center gap-4 mb-8\">\n          {logo && <img src={logo} alt=\"Logo\" className=\"w-12 h-12 rounded-xl\" />}\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-pink-500/30 to-purple-500/30 rounded-xl flex items-center justify-center\">\n              <Icon className=\"w-6 h-6 text-pink-400\" />\n            </div>\n            <h1 className=\"text-3xl md:text-4xl font-bold\">{title}</h1>\n          </div>\n        </div>\n\n        <div className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6 md:p-8\">\n          {children}\n        </div>\n\n        <footer className=\"mt-12 text-center text-gray-500 text-sm\">\n          <p>Carnival Planner - Plan your Mas. Track your Fetes. Coordinate your Squad.</p>\n        </footer>\n      </div>\n    </div>\n  );\n}\n\nfunction Section({ title, children }) {\n  return (\n    <div className=\"mb-8\">\n      <h3 className=\"text-xl font-bold text-white mb-4\">{title}</h3>\n      <div className=\"text-gray-300 leading-relaxed\">{children}</div>\n    </div>\n  );\n}\n","path":null,"size_bytes":23351,"size_tokens":null},"public/firebase-messaging-sw.js":{"content":"importScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js');\nimportScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js');\n\nfirebase.initializeApp({\n  apiKey: \"AIzaSyCWp0X6bLJBsyYKTjUaVsXBSuVD8KeeEqY\",\n  authDomain: \"carnival-planner.firebaseapp.com\",\n  projectId: \"carnival-planner\",\n  storageBucket: \"carnival-planner.firebasestorage.app\",\n  messagingSenderId: \"1036340118282\",\n  appId: \"1:1036340118282:web:809dc12c298ff1b8f2f0f3\"\n});\n\nconst messaging = firebase.messaging();\n\nmessaging.onBackgroundMessage((payload) => {\n  console.log('Received background message:', payload);\n  \n  const notificationTitle = payload.notification?.title || 'Squad Alert';\n  const notificationOptions = {\n    body: payload.notification?.body || 'Someone in your squad is Road Ready!',\n    icon: '/carnival-logo.png',\n    badge: '/carnival-logo.png',\n    vibrate: [200, 100, 200],\n    tag: 'road-ready-alert',\n    data: payload.data\n  };\n\n  self.registration.showNotification(notificationTitle, notificationOptions);\n});\n\nself.addEventListener('notificationclick', (event) => {\n  event.notification.close();\n  event.waitUntil(\n    clients.openWindow('/')\n  );\n});\n","path":null,"size_bytes":1195,"size_tokens":null},"src/components/EmailAuthForm.jsx":{"content":"import React, { useState } from 'react';\nimport {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  sendEmailVerification,\n  sendPasswordResetEmail,\n} from 'firebase/auth';\nimport { auth } from '../firebase';\nimport { Mail, Lock, Eye, EyeOff, ArrowLeft, Loader2 } from 'lucide-react';\n\nexport default function EmailAuthForm({ onBack, onSuccess }) {\n  const [mode, setMode] = useState('login');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n\n  const validateEmail = (email) => {\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n  };\n\n  const getErrorMessage = (errorCode) => {\n    switch (errorCode) {\n      case 'auth/email-already-in-use':\n        return 'This email is already registered. Try logging in instead.';\n      case 'auth/invalid-email':\n        return 'Please enter a valid email address.';\n      case 'auth/weak-password':\n        return 'Password should be at least 6 characters.';\n      case 'auth/user-not-found':\n        return 'No account found with this email.';\n      case 'auth/wrong-password':\n        return 'Incorrect password. Please try again.';\n      case 'auth/invalid-credential':\n        return 'Invalid email or password. Please check and try again.';\n      case 'auth/too-many-requests':\n        return 'Too many attempts. Please try again later.';\n      default:\n        return 'Something went wrong. Please try again.';\n    }\n  };\n\n  const handleSignUp = async (e) => {\n    e.preventDefault();\n    setError('');\n    setSuccessMessage('');\n\n    if (!validateEmail(email)) {\n      setError('Please enter a valid email address.');\n      return;\n    }\n\n    if (password.length < 6) {\n      setError('Password must be at least 6 characters.');\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      setError('Passwords do not match.');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      await sendEmailVerification(userCredential.user);\n      setSuccessMessage('Account created! Please check your email to verify your account.');\n      if (onSuccess) onSuccess(userCredential.user);\n    } catch (err) {\n      console.error('Sign up error:', err);\n      setError(getErrorMessage(err.code));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setError('');\n    setSuccessMessage('');\n\n    if (!validateEmail(email)) {\n      setError('Please enter a valid email address.');\n      return;\n    }\n\n    if (!password) {\n      setError('Please enter your password.');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\n      if (onSuccess) onSuccess(userCredential.user);\n    } catch (err) {\n      console.error('Login error:', err);\n      setError(getErrorMessage(err.code));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleForgotPassword = async () => {\n    setError('');\n    setSuccessMessage('');\n\n    if (!validateEmail(email)) {\n      setError('Please enter your email address first.');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      await sendPasswordResetEmail(auth, email);\n      setSuccessMessage('Password reset email sent! Check your inbox.');\n    } catch (err) {\n      console.error('Password reset error:', err);\n      setError(getErrorMessage(err.code));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleResendVerification = async () => {\n    if (auth.currentUser && !auth.currentUser.emailVerified) {\n      setIsLoading(true);\n      try {\n        await sendEmailVerification(auth.currentUser);\n        setSuccessMessage('Verification email sent! Check your inbox.');\n      } catch (err) {\n        setError('Could not send verification email. Try again later.');\n      } finally {\n        setIsLoading(false);\n      }\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-md mx-auto\">\n      <button\n        onClick={onBack}\n        className=\"flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition-colors\"\n      >\n        <ArrowLeft className=\"w-4 h-4\" />\n        Back\n      </button>\n\n      <div className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6\">\n        <h2 className=\"text-2xl font-bold text-white mb-6 text-center\">\n          {mode === 'login' ? 'Welcome Back' : 'Create Account'}\n        </h2>\n\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm\">\n            {error}\n          </div>\n        )}\n\n        {successMessage && (\n          <div className=\"mb-4 p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm\">\n            {successMessage}\n          </div>\n        )}\n\n        <form onSubmit={mode === 'login' ? handleLogin : handleSignUp} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm text-gray-400 mb-1\">Email</label>\n            <div className=\"relative\">\n              <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500\" />\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"your@email.com\"\n                className=\"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors\"\n                disabled={isLoading}\n              />\n            </div>\n          </div>\n\n          <div>\n            <label className=\"block text-sm text-gray-400 mb-1\">Password</label>\n            <div className=\"relative\">\n              <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500\" />\n              <input\n                type={showPassword ? 'text' : 'password'}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Enter your password\"\n                className=\"w-full pl-10 pr-12 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors\"\n                disabled={isLoading}\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300\"\n              >\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n              </button>\n            </div>\n          </div>\n\n          {mode === 'signup' && (\n            <div>\n              <label className=\"block text-sm text-gray-400 mb-1\">Confirm Password</label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500\" />\n                <input\n                  type={showPassword ? 'text' : 'password'}\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  placeholder=\"Confirm your password\"\n                  className=\"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors\"\n                  disabled={isLoading}\n                />\n              </div>\n            </div>\n          )}\n\n          {mode === 'login' && (\n            <div className=\"text-right\">\n              <button\n                type=\"button\"\n                onClick={handleForgotPassword}\n                className=\"text-sm text-pink-400 hover:text-pink-300 transition-colors\"\n                disabled={isLoading}\n              >\n                Forgot password?\n              </button>\n            </div>\n          )}\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"w-full py-3 bg-gradient-to-r from-pink-500 to-orange-500 rounded-xl font-bold text-white hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center justify-center gap-2\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"w-5 h-5 animate-spin\" />\n                {mode === 'login' ? 'Signing in...' : 'Creating account...'}\n              </>\n            ) : (\n              mode === 'login' ? 'Sign In' : 'Create Account'\n            )}\n          </button>\n        </form>\n\n        <div className=\"mt-6 text-center\">\n          <p className=\"text-gray-400 text-sm\">\n            {mode === 'login' ? \"Don't have an account?\" : 'Already have an account?'}\n            <button\n              onClick={() => {\n                setMode(mode === 'login' ? 'signup' : 'login');\n                setError('');\n                setSuccessMessage('');\n              }}\n              className=\"ml-2 text-pink-400 hover:text-pink-300 font-semibold transition-colors\"\n            >\n              {mode === 'login' ? 'Sign Up' : 'Sign In'}\n            </button>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function EmailVerificationBanner({ user, onResend }) {\n  const [isSending, setIsSending] = useState(false);\n  const [sent, setSent] = useState(false);\n\n  if (!user || user.emailVerified || !user.email) {\n    return null;\n  }\n\n  const handleResend = async () => {\n    setIsSending(true);\n    try {\n      await sendEmailVerification(user);\n      setSent(true);\n      setTimeout(() => setSent(false), 5000);\n    } catch (err) {\n      console.error('Error sending verification:', err);\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-yellow-500/20 border border-yellow-500/30 text-yellow-200 px-4 py-3 flex items-center justify-between gap-4 flex-wrap\">\n      <div className=\"flex items-center gap-2\">\n        <Mail className=\"w-5 h-5\" />\n        <span className=\"text-sm\">Please verify your email address to access all features.</span>\n      </div>\n      <button\n        onClick={handleResend}\n        disabled={isSending || sent}\n        className=\"text-sm font-semibold bg-yellow-500/30 hover:bg-yellow-500/40 px-3 py-1 rounded-lg transition-colors disabled:opacity-50\"\n      >\n        {sent ? 'Email Sent!' : isSending ? 'Sending...' : 'Resend Email'}\n      </button>\n    </div>\n  );\n}\n","path":null,"size_bytes":10744,"size_tokens":null},"src/components/MediaVault.jsx":{"content":"import { useState, useRef } from 'react';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { storage } from '../firebase';\nimport { ImagePlus, Ticket, Trash2, Download, Eye, X, Upload, Loader2 } from 'lucide-react';\n\nconst FILE_TYPES = {\n  ticket: { label: 'Ticket', icon: Ticket, color: '#F59E0B' },\n  photo: { label: 'Photo', icon: ImagePlus, color: '#3B82F6' },\n};\n\nexport default function MediaVault({ files = [], onFilesChange, carnivalName, carnivalId, userId }) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState('');\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [fileType, setFileType] = useState('ticket');\n  const [fileName, setFileName] = useState('');\n  const fileInputRef = useRef(null);\n\n  const handleFileSelect = async (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    const maxSize = 10 * 1024 * 1024;\n    if (file.size > maxSize) {\n      alert('File too large. Maximum size is 10MB.');\n      return;\n    }\n\n    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'application/pdf'];\n    if (!validTypes.includes(file.type)) {\n      alert('Invalid file type. Please upload an image (JPG, PNG, GIF, WebP) or PDF.');\n      return;\n    }\n\n    setIsUploading(true);\n    setUploadProgress('Uploading...');\n\n    try {\n      const timestamp = Date.now();\n      const fileExtension = file.name.split('.').pop();\n      const storagePath = `users/${userId}/carnivals/${carnivalId}/${timestamp}.${fileExtension}`;\n      const storageRef = ref(storage, storagePath);\n\n      await uploadBytes(storageRef, file);\n      const downloadUrl = await getDownloadURL(storageRef);\n\n      const newFile = {\n        id: timestamp.toString(),\n        name: fileName || file.name.split('.')[0],\n        type: fileType,\n        url: downloadUrl,\n        storagePath: storagePath,\n        originalName: file.name,\n        uploadedAt: new Date().toISOString(),\n        fileType: file.type,\n      };\n\n      onFilesChange([...files, newFile]);\n      setFileName('');\n      setUploadProgress('');\n      if (fileInputRef.current) fileInputRef.current.value = '';\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Failed to upload file. Please try again.');\n    }\n    \n    setIsUploading(false);\n  };\n\n  const deleteFile = async (fileToDelete) => {\n    if (!confirm('Are you sure you want to delete this file?')) return;\n\n    try {\n      const storageRef = ref(storage, fileToDelete.storagePath);\n      await deleteObject(storageRef);\n      onFilesChange(files.filter(f => f.id !== fileToDelete.id));\n    } catch (error) {\n      console.error('Delete error:', error);\n      onFilesChange(files.filter(f => f.id !== fileToDelete.id));\n    }\n  };\n\n  const downloadFile = (file) => {\n    const link = document.createElement('a');\n    link.href = file.url;\n    link.download = file.originalName || file.name;\n    link.target = '_blank';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const tickets = files.filter(f => f.type === 'ticket');\n  const photos = files.filter(f => f.type === 'photo');\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2\">\n            <ImagePlus className=\"w-5 h-5 text-purple-500\" />\n            Media Vault\n          </h3>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            Store your tickets, photos, and important documents for {carnivalName}\n          </p>\n        </div>\n      </div>\n\n      <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl p-4 border border-purple-100 dark:border-purple-800\">\n        <h4 className=\"font-semibold text-gray-800 dark:text-white mb-3\">Upload New File</h4>\n        <div className=\"grid gap-3\">\n          <div className=\"flex gap-3\">\n            <input\n              type=\"text\"\n              placeholder=\"File label (e.g., 'Tribe Costume Receipt')\"\n              value={fileName}\n              onChange={(e) => setFileName(e.target.value)}\n              className=\"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            />\n            <select\n              value={fileType}\n              onChange={(e) => setFileType(e.target.value)}\n              className=\"px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            >\n              {Object.entries(FILE_TYPES).map(([key, { label }]) => (\n                <option key={key} value={key}>{label}</option>\n              ))}\n            </select>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*,.pdf\"\n              onChange={handleFileSelect}\n              className=\"hidden\"\n              id=\"file-upload\"\n            />\n            <label\n              htmlFor=\"file-upload\"\n              className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg cursor-pointer transition ${\n                isUploading \n                  ? 'border-gray-300 bg-gray-50 dark:bg-gray-800 cursor-not-allowed' \n                  : 'border-purple-300 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20'\n              }`}\n            >\n              {isUploading ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin text-purple-500\" />\n                  <span className=\"text-purple-600 dark:text-purple-400\">{uploadProgress}</span>\n                </>\n              ) : (\n                <>\n                  <Upload className=\"w-5 h-5 text-purple-500\" />\n                  <span className=\"text-purple-600 dark:text-purple-400 font-medium\">\n                    Click to upload image or PDF (max 10MB)\n                  </span>\n                </>\n              )}\n            </label>\n          </div>\n        </div>\n      </div>\n\n      {tickets.length > 0 && (\n        <div>\n          <h4 className=\"font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2\">\n            <Ticket className=\"w-4 h-4 text-yellow-500\" />\n            Tickets ({tickets.length})\n          </h4>\n          <div className=\"grid gap-3\">\n            {tickets.map((file) => (\n              <FileCard key={file.id} file={file} onView={setSelectedFile} onDownload={downloadFile} onDelete={deleteFile} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {photos.length > 0 && (\n        <div>\n          <h4 className=\"font-semibold text-gray-800 dark:text-white mb-3 flex items-center gap-2\">\n            <ImagePlus className=\"w-4 h-4 text-blue-500\" />\n            Photos ({photos.length})\n          </h4>\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\n            {photos.map((file) => (\n              <PhotoCard key={file.id} file={file} onView={setSelectedFile} onDownload={downloadFile} onDelete={deleteFile} />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {files.length === 0 && (\n        <div className=\"text-center py-12 text-gray-500 dark:text-gray-400\">\n          <ImagePlus className=\"w-16 h-16 mx-auto mb-3 opacity-30\" />\n          <p className=\"font-medium\">No files uploaded yet</p>\n          <p className=\"text-sm\">Upload your tickets, costume receipts, and travel photos</p>\n        </div>\n      )}\n\n      {selectedFile && (\n        <div className=\"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4\" onClick={() => setSelectedFile(null)}>\n          <div className=\"relative max-w-4xl max-h-[90vh] w-full\" onClick={e => e.stopPropagation()}>\n            <button\n              onClick={() => setSelectedFile(null)}\n              className=\"absolute -top-12 right-0 text-white hover:text-gray-300\"\n            >\n              <X className=\"w-8 h-8\" />\n            </button>\n            {selectedFile.fileType === 'application/pdf' ? (\n              <iframe src={selectedFile.url} className=\"w-full h-[80vh] rounded-lg\" />\n            ) : (\n              <img src={selectedFile.url} alt={selectedFile.name} className=\"max-w-full max-h-[80vh] mx-auto rounded-lg\" />\n            )}\n            <p className=\"text-white text-center mt-4 font-medium\">{selectedFile.name}</p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction FileCard({ file, onView, onDownload, onDelete }) {\n  const typeConfig = FILE_TYPES[file.type] || FILE_TYPES.ticket;\n  const IconComponent = typeConfig.icon;\n\n  return (\n    <div className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-100 dark:border-gray-600 shadow-sm\">\n      <div className=\"flex items-center gap-3\">\n        <div\n          className=\"w-10 h-10 rounded-lg flex items-center justify-center\"\n          style={{ backgroundColor: `${typeConfig.color}20` }}\n        >\n          <IconComponent className=\"w-5 h-5\" style={{ color: typeConfig.color }} />\n        </div>\n        <div>\n          <p className=\"font-medium text-gray-800 dark:text-white\">{file.name}</p>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n            {new Date(file.uploadedAt).toLocaleDateString()}\n          </p>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-1\">\n        <button\n          onClick={() => onView(file)}\n          className=\"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\n        >\n          <Eye className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => onDownload(file)}\n          className=\"p-2 text-gray-500 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition\"\n        >\n          <Download className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => onDelete(file)}\n          className=\"p-2 text-gray-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\n        >\n          <Trash2 className=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction PhotoCard({ file, onView, onDownload, onDelete }) {\n  return (\n    <div className=\"relative group rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600\">\n      <img\n        src={file.url}\n        alt={file.name}\n        className=\"w-full h-32 object-cover cursor-pointer\"\n        onClick={() => onView(file)}\n      />\n      <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n        <button\n          onClick={() => onView(file)}\n          className=\"p-2 bg-white/20 hover:bg-white/30 rounded-full text-white transition\"\n        >\n          <Eye className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => onDownload(file)}\n          className=\"p-2 bg-white/20 hover:bg-white/30 rounded-full text-white transition\"\n        >\n          <Download className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => onDelete(file)}\n          className=\"p-2 bg-red-500/50 hover:bg-red-500/70 rounded-full text-white transition\"\n        >\n          <Trash2 className=\"w-4 h-4\" />\n        </button>\n      </div>\n      <p className=\"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs p-2 truncate\">\n        {file.name}\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":11622,"size_tokens":null},"src/components/InstallPrompt.jsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Download, X, Smartphone } from 'lucide-react';\n\nexport default function InstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n  const [dismissed, setDismissed] = useState(false);\n\n  useEffect(() => {\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      setIsInstalled(true);\n      return;\n    }\n\n    const dismissedTime = localStorage.getItem('pwa-install-dismissed');\n    if (dismissedTime) {\n      const daysSinceDismissed = (Date.now() - parseInt(dismissedTime)) / (1000 * 60 * 60 * 24);\n      if (daysSinceDismissed < 7) {\n        setDismissed(true);\n      }\n    }\n\n    const handleBeforeInstall = (e) => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      if (!dismissed) {\n        setShowPrompt(true);\n      }\n    };\n\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setShowPrompt(false);\n      setDeferredPrompt(null);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstall);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstall);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, [dismissed]);\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return;\n\n    deferredPrompt.prompt();\n    const { outcome } = await deferredPrompt.userChoice;\n    \n    if (outcome === 'accepted') {\n      setIsInstalled(true);\n    }\n    \n    setDeferredPrompt(null);\n    setShowPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    setDismissed(true);\n    localStorage.setItem('pwa-install-dismissed', Date.now().toString());\n  };\n\n  if (!showPrompt || isInstalled) return null;\n\n  return (\n    <div className=\"fixed bottom-20 left-4 right-4 z-40 animate-slideUp md:left-auto md:right-4 md:max-w-sm safe-bottom\">\n      <div className=\"bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl shadow-2xl p-4 text-white\">\n        <button \n          onClick={handleDismiss}\n          className=\"absolute top-2 right-2 p-1 hover:bg-white/20 rounded-full transition-colors\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n        \n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0\">\n            <Smartphone className=\"w-6 h-6\" />\n          </div>\n          \n          <div className=\"flex-1 pr-6\">\n            <h3 className=\"font-bold text-lg mb-1\">Add to Home Screen</h3>\n            <p className=\"text-white/80 text-sm mb-3\">\n              Install Carnival Planner for quick access and offline use!\n            </p>\n            \n            <button\n              onClick={handleInstall}\n              className=\"flex items-center gap-2 px-4 py-2 bg-white text-purple-600 font-bold rounded-lg hover:bg-gray-100 transition-colors\"\n            >\n              <Download className=\"w-4 h-4\" />\n              Install App\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3266,"size_tokens":null},"src/components/AccountSettings.jsx":{"content":"import React, { useState } from 'react';\nimport { Trash2, AlertTriangle, Loader2, X } from 'lucide-react';\nimport { getFunctions, httpsCallable } from 'firebase/functions';\nimport { signOut } from 'firebase/auth';\nimport app, { auth } from '../firebase';\n\nexport default function AccountSettings({ user, onClose }) {\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [deleteConfirmText, setDeleteConfirmText] = useState('');\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleDeleteAccount = async () => {\n    if (deleteConfirmText !== 'DELETE') {\n      setError('Please type DELETE to confirm');\n      return;\n    }\n\n    setIsDeleting(true);\n    setError('');\n\n    try {\n      const functions = getFunctions(app);\n      const deleteUserAccount = httpsCallable(functions, 'deleteUserAccount');\n      await deleteUserAccount();\n      \n      await signOut(auth);\n      window.location.reload();\n    } catch (err) {\n      console.error('Error deleting account:', err);\n      setError(err.message || 'Failed to delete account. Please try again.');\n      setIsDeleting(false);\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h3 className=\"text-lg font-bold text-gray-800 dark:text-white\">Account Settings</h3>\n        {onClose && (\n          <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\">\n            <X className=\"w-5 h-5\" />\n          </button>\n        )}\n      </div>\n\n      <div className=\"space-y-6\">\n        <div>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">Signed in as</p>\n          <p className=\"font-medium text-gray-800 dark:text-white\">{user?.email}</p>\n        </div>\n\n        <div className=\"border-t border-gray-200 dark:border-gray-700 pt-6\">\n          <h4 className=\"text-red-600 dark:text-red-400 font-bold mb-2 flex items-center gap-2\">\n            <AlertTriangle className=\"w-5 h-5\" />\n            Danger Zone\n          </h4>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4\">\n            Permanently delete your account and all associated data. This action cannot be undone.\n          </p>\n\n          {!showDeleteConfirm ? (\n            <button\n              onClick={() => setShowDeleteConfirm(true)}\n              className=\"flex items-center gap-2 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors\"\n            >\n              <Trash2 className=\"w-4 h-4\" />\n              Delete My Account\n            </button>\n          ) : (\n            <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4\">\n              <p className=\"text-sm text-red-600 dark:text-red-400 mb-3\">\n                This will permanently delete:\n              </p>\n              <ul className=\"text-sm text-red-500 dark:text-red-400 list-disc list-inside mb-4 space-y-1\">\n                <li>All your carnival plans and data</li>\n                <li>Uploaded photos and documents</li>\n                <li>Squad memberships</li>\n                <li>Your account and login</li>\n              </ul>\n              \n              <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Type <span className=\"font-mono bg-gray-200 dark:bg-gray-700 px-1 rounded\">DELETE</span> to confirm:\n              </p>\n              <input\n                type=\"text\"\n                value={deleteConfirmText}\n                onChange={(e) => setDeleteConfirmText(e.target.value)}\n                placeholder=\"Type DELETE\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3\"\n              />\n\n              {error && (\n                <p className=\"text-red-500 text-sm mb-3\">{error}</p>\n              )}\n\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={() => {\n                    setShowDeleteConfirm(false);\n                    setDeleteConfirmText('');\n                    setError('');\n                  }}\n                  disabled={isDeleting}\n                  className=\"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleDeleteAccount}\n                  disabled={isDeleting || deleteConfirmText !== 'DELETE'}\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50\"\n                >\n                  {isDeleting ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      Deleting...\n                    </>\n                  ) : (\n                    <>\n                      <Trash2 className=\"w-4 h-4\" />\n                      Delete Forever\n                    </>\n                  )}\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5464,"size_tokens":null},"src/components/ContactSupport.jsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { ArrowLeft, Send, MessageSquare, CheckCircle, Loader2, Mail, Trash2 } from 'lucide-react';\nimport { collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc, Timestamp } from 'firebase/firestore';\nimport { db } from '../firebase';\n\nexport function ContactPage({ onBack, logo, user }) {\n  const [subject, setSubject] = useState('');\n  const [message, setMessage] = useState('');\n  const [email, setEmail] = useState(user?.email || '');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!message.trim() || !email.trim()) {\n      setError('Please fill in all required fields');\n      return;\n    }\n\n    setIsSubmitting(true);\n    setError('');\n\n    try {\n      await addDoc(collection(db, 'support-requests'), {\n        email: email.trim(),\n        subject: subject.trim() || 'General Inquiry',\n        message: message.trim(),\n        userId: user?.uid || null,\n        userName: user?.displayName || null,\n        status: 'new',\n        createdAt: Timestamp.now()\n      });\n\n      setSubmitted(true);\n      setSubject('');\n      setMessage('');\n    } catch (err) {\n      console.error('Error submitting support request:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (submitted) {\n    return (\n      <div className=\"min-h-screen bg-slate-950 text-white flex items-center justify-center p-6\">\n        <div className=\"text-center max-w-md\">\n          <div className=\"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <CheckCircle className=\"w-10 h-10 text-green-400\" />\n          </div>\n          <h2 className=\"text-2xl font-bold mb-4\">Message Sent!</h2>\n          <p className=\"text-gray-400 mb-8\">\n            Thank you for reaching out. We'll get back to you as soon as possible.\n          </p>\n          <button\n            onClick={onBack}\n            className=\"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl font-bold hover:opacity-90 transition-opacity\"\n          >\n            Back to App\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-950 text-white\">\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute w-[600px] h-[600px] bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-full blur-3xl -top-48 -right-48\" />\n        <div className=\"absolute w-[400px] h-[400px] bg-gradient-to-r from-blue-500/15 to-cyan-500/15 rounded-full blur-3xl bottom-0 left-0\" />\n      </div>\n\n      <div className=\"relative max-w-2xl mx-auto px-6 py-12\">\n        <button\n          onClick={onBack}\n          className=\"flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-8\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n          Back\n        </button>\n\n        <div className=\"flex items-center gap-4 mb-8\">\n          {logo && <img src={logo} alt=\"Logo\" className=\"w-12 h-12 rounded-xl\" />}\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-pink-500/30 to-purple-500/30 rounded-xl flex items-center justify-center\">\n              <MessageSquare className=\"w-6 h-6 text-pink-400\" />\n            </div>\n            <h1 className=\"text-3xl md:text-4xl font-bold\">Contact Support</h1>\n          </div>\n        </div>\n\n        <div className=\"bg-white/5 backdrop-blur-sm border border-white/10 rounded-2xl p-6 md:p-8\">\n          <p className=\"text-gray-400 mb-6\">\n            Have a question, feedback, or need help? Send us a message and we'll get back to you as soon as possible.\n          </p>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Email Address *\n              </label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500\" />\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"your@email.com\"\n                  required\n                  className=\"w-full pl-10 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Subject\n              </label>\n              <select\n                value={subject}\n                onChange={(e) => setSubject(e.target.value)}\n                className=\"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-pink-500 transition-colors\"\n              >\n                <option value=\"\" className=\"bg-gray-900\">Select a topic...</option>\n                <option value=\"General Question\" className=\"bg-gray-900\">General Question</option>\n                <option value=\"Premium Subscription\" className=\"bg-gray-900\">Premium Subscription</option>\n                <option value=\"Technical Issue\" className=\"bg-gray-900\">Technical Issue</option>\n                <option value=\"Feature Request\" className=\"bg-gray-900\">Feature Request</option>\n                <option value=\"Refund Request\" className=\"bg-gray-900\">Refund Request</option>\n                <option value=\"Account Issue\" className=\"bg-gray-900\">Account Issue</option>\n                <option value=\"Other\" className=\"bg-gray-900\">Other</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Message *\n              </label>\n              <textarea\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                placeholder=\"How can we help you?\"\n                required\n                rows={6}\n                className=\"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors resize-none\"\n              />\n            </div>\n\n            {error && (\n              <p className=\"text-red-400 text-sm\">{error}</p>\n            )}\n\n            <button\n              type=\"submit\"\n              disabled={isSubmitting}\n              className=\"w-full flex items-center justify-center gap-2 px-6 py-4 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity disabled:opacity-50\"\n            >\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  Sending...\n                </>\n              ) : (\n                <>\n                  <Send className=\"w-5 h-5\" />\n                  Send Message\n                </>\n              )}\n            </button>\n          </form>\n        </div>\n\n        <p className=\"text-gray-500 text-sm text-center mt-8\">\n          You can also email us directly at{' '}\n          <a href=\"mailto:support@carnival-planner.com\" className=\"text-pink-400 hover:underline\">\n            support@carnival-planner.com\n          </a>\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport function SupportAdmin() {\n  const [requests, setRequests] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const q = query(collection(db, 'support-requests'), orderBy('createdAt', 'desc'));\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const items = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setRequests(items);\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n\n  const handleDelete = async (id) => {\n    if (confirm('Delete this support request?')) {\n      await deleteDoc(doc(db, 'support-requests', id));\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"text-center py-8 text-gray-500\">\n        <Loader2 className=\"w-6 h-6 animate-spin mx-auto\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6\">\n      <h3 className=\"font-bold text-lg mb-4 text-gray-800 dark:text-white flex items-center gap-2\">\n        <MessageSquare className=\"w-5 h-5\" />\n        Support Requests ({requests.length})\n      </h3>\n\n      {requests.length === 0 ? (\n        <p className=\"text-gray-500 text-center py-4\">No support requests yet</p>\n      ) : (\n        <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n          {requests.map((req) => (\n            <div \n              key={req.id} \n              className=\"bg-gray-50 dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\"\n            >\n              <div className=\"flex justify-between items-start mb-2\">\n                <div>\n                  <span className=\"font-medium text-gray-800 dark:text-white\">{req.email}</span>\n                  <span className=\"mx-2 text-gray-400\">|</span>\n                  <span className=\"text-sm text-gray-500\">{req.subject || 'General'}</span>\n                </div>\n                <button\n                  onClick={() => handleDelete(req.id)}\n                  className=\"p-1 text-gray-400 hover:text-red-500 transition-colors\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </button>\n              </div>\n              <p className=\"text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap\">{req.message}</p>\n              <p className=\"text-xs text-gray-400 mt-2\">\n                {req.createdAt?.toDate?.().toLocaleString() || 'Unknown date'}\n              </p>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ContactPage;\n","path":null,"size_bytes":10168,"size_tokens":null}},"version":2}